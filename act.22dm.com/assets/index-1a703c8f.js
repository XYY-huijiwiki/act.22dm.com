import{ae as e,_ as a,d as s,Z as l,o as i,c as t,j as o,F as d,v as c,q as n,m as r,y as u,z as m,k as p,l as v,T as f,Y as h,u as g,a as y,f as w,i as b,a1 as k,x as C,A as x,af as M,ag as L,D as _,E as U,G as j,H as A}from"./index-d8b3cf2b.js";import{w as D}from"./wxjssdk-660da706.js";import{T as I,I as q}from"./index-73c689da.js";import"./isObjectLike-38825d63.js";let B="/h5/activity";const T=s({name:"drift-bottle",components:{Textarea:I,Input:q},setup(a,s){var l,i;const{proxy:t}=A();let o=new D({});h();const d=g(),c=y({loading:!1,volume:!1,award:!1,awardDetail:null,dialogs:"",alert:"",wishTreeList:[{id:4,color:"red",type:"ing"},{id:5,color:"yellow",type:"success"},{id:3,color:"red",type:"ing"},{id:6,color:"yellow",type:"success"},{id:7,color:"yellow",type:"success"},{id:2,color:"blue",type:"finish"},{id:8,color:"yellow",type:"success"},{id:1,color:"blue",type:"finish"},{id:9,color:"yellow",type:"success"},{id:10,color:"yellow",type:"success"},{id:11,color:"yellow",type:"success"},{id:12,color:"yellow",type:"success"},{id:13,color:"yellow",type:"success"},{id:14,color:"empty",type:"empty"},{id:15,color:"empty",type:"empty"}],recordList:[],detail:{id:5,color:"yellow",type:"success"},form:{content:"",name:"",phone:"",address:""},userInfo:(null==(l=d.params)?void 0:l.userInfo)??{},audioList:[{name:"bgm",src:"https://cpe-app-oss.oss-cn-shenzhen.aliyuncs.com/h5/wish/bgm1.mp3",loop:!0}]});let n=(null==(i=c.userInfo)?void 0:i.unionid)??"",r="wishTree",u=4;const m=e=>{if("award"==e){if(c.awardDetail)return void(c.alert="你已填写过信息")}else c.dialogs=e},p=()=>{var a;(a={ownerUnionid:n,activityKey:r,periodNum:u},e({url:B+`/wish-tree/list?ownerUnionid=${a.ownerUnionid}`,method:"post",data:a})).then((({code:e,data:a})=>{0===e&&(u=a.periodNum,r=a.activityKey)}))},v=()=>{var a;(a={ownerUnionid:n},e({url:B+"/wish-tree/records?ownerUnionid="+a.ownerUnionid,method:"post",data:a})).then((({code:e,data:a})=>{0===e&&(c.recordList=a.wishTreeList.filter((e=>{if(2==e.wishType&&(0==e.wishStatus||3==e.wishStatus))return e})),c.award=a.wishTreeList.some((e=>e.periodNum==u-1&&3==e.wishStatus)),c.award&&L({unionid:n,activityKey:r,periodNum:1}).then((e=>{var a;(null==(a=e.data)?void 0:a.name)&&(c.awardDetail=e.data)})))}))},f=(e,a=!1)=>{try{if(a&&(c.volume=!c.volume,c.volume||b()),c.volume){let a=document.getElementById("audio-item-"+e);a.paused&&a.play()}}catch(s){}};return w((()=>{var e,a;if(p(),v(),null==(e=d.query)?void 0:e.type){m(["","record","letter","card-theme","rule"][1*d.query.type])}let s=location.origin+d.path,l=(null==(a=d.meta)?void 0:a.imgUrl)??"";o.ready((()=>{var e,a;f("bgm",!0),o.updateShareData({title:(null==(e=d.meta)?void 0:e.title)??"",desc:(null==(a=d.meta)?void 0:a.desc)??"",link:s,imgUrl:l}),document.addEventListener("visibilitychange",(e=>{document.hidden?b():c.volume&&f("bgm")}))}))})),{...k(c),onStarDetail:e=>{let{id:a}=e;switch(a){case 1:c.dialogs="card-xi";break;case 2:c.dialogs="card-mei";break;case 3:c.dialogs="card-nuan";break;case 4:c.dialogs="card-lan";break;case 14:case 15:c.dialogs="letter";break;default:c.detail=e,c.dialogs="success"}},onBtn:m,onWishSubmit:()=>{if(c.loading)return;if(c.recordList.filter((e=>e.periodNum==u)).length<1){let s=c.form.content;if(M(s)){c.loading=!0,(a={periodNum:u,ownerUnionid:n,content:s},e({url:B+"/wish-tree/submit",method:"post",data:a})).then((({code:e,data:a})=>{0===e&&(c.dialogs="",c.form.content="",c.alert="submit-success",v())})).catch((e=>{c.alert="submit-0"})).finally((()=>{c.loading=!1}))}else c.alert="submit-empty"}else c.alert="submit-0";var a},onCardContentLink:(e="")=>{"letter"==e&&(c.dialogs="card-theme"),"card-xi"==c.dialogs?location.href="https://mp.weixin.qq.com/s?__biz=MjM5MDAxMzI0MA==&mid=2649622435&idx=1&sn=675995ccff783286d4efc629be6706a1&chksm=be51e5f489266ce249529aa7449cb0f490dc81f5b3b044a19865313793acf1c4a3e1c19b0514#rd":"card-fei"==c.dialogs?location.href="https://mp.weixin.qq.com/s?__biz=MjM5MDAxMzI0MA==&mid=2649612015&idx=1&sn=8dff45a3261c9cbd4c8aa9a2046a648b&chksm=be523cb88925b5ae3ed8079b78d277ba3304b8fbac7e5bc699af38c26724753fe9e55eecfc33#rd":"card-mei"==c.dialogs?c.alert="shop":"card-lan"==c.dialogs&&(location.href="https://mp.weixin.qq.com/s?__biz=MjM5MDAxMzI0MA==&mid=2649613789&idx=1&sn=dd59068449e6fece5dc1c86d9463a8de&chksm=be52078a89258e9cc89e6cf577d29ec44b6afa06073e698bf9b00d7f347c019060d0e10cdbe6#rd")},onPlayAudio:f,submitAward:()=>{let{name:e,phone:a,address:s}=c.form;e&&a&&s?11==a.length?_({activityKey:"bottleReward",periodNum:u-1,ownerUnionid:n,address:s,name:e,phone:a,extra:{activityKey:r}}).then((()=>{c.alert="提交成功",c.dialogs="",c.awardDetail={address:s,name:e,phone:a}})):c.alert="请填写11位手机号码":c.alert="请输入正确的信息"},showMessage:e=>{t.$Message.success(e)}}}}),z=e=>(U("data-v-1e707f84"),e=e(),j(),e),N={id:"page-wish"},S={class:"wish-btn"},K={class:"tree-main"},E=["onClick"],O=z((()=>o("span",{class:"tree-role"},null,-1))),P={class:"page-dialogs"},W={class:"letter-content"},$={class:"letter-text"},F={class:"rule-wrap"},G=z((()=>o("div",{class:"title-rule"},null,-1))),H=z((()=>o("div",{class:"rule-tips"},null,-1))),R=z((()=>o("div",{class:"rule-content"},null,-1))),Y={class:"card-ufo"},Z=[z((()=>o("span",{class:"card-star"},null,-1)))],J={class:"card-flower"},Q={class:"success-wrap"},V=z((()=>o("div",{class:"title-success"},null,-1))),X={key:0,class:"success-content"},ee=["src"],ae={class:"success-btn"},se={class:"record-wrap"},le=z((()=>o("div",{class:"title-record"},null,-1))),ie={class:"record-list"},te={class:"record-content"},oe={class:"record-content-text"},de={key:0,class:"record-item"},ce=[z((()=>o("div",{class:"title-11"},null,-1))),z((()=>o("div",{class:"record-content"},[o("span",{class:"alert-empty"})],-1)))],ne={class:"alert-main"},re={key:0,class:"dialogs-award"},ue={id:"audio-list"},me=["id","src","loop"];const pe=a(T,[["render",function(e,a,s,h,g,y){const w=l("Textarea"),b=l("Input");return i(),t("div",N,[o("div",{class:r(["wish-tree",{filter:e.dialogs||e.alert}])},[o("div",S,[o("span",{class:"btn-record",onClick:a[0]||(a[0]=a=>e.onBtn("record"))}),o("span",{class:"btn-wish",onClick:a[1]||(a[1]=a=>e.onBtn("letter"))}),o("span",{class:"btn-theme",onClick:a[2]||(a[2]=a=>e.onBtn("card-theme"))}),o("span",{class:"btn-rule",onClick:a[3]||(a[3]=a=>e.onBtn("rule"))})]),o("div",K,[(i(!0),t(d,null,c(e.wishTreeList,((a,s)=>(i(),t("span",{key:"star-"-s,class:r(["star-"+a.color,"position-"+(s+1)]),onClick:s=>e.onStarDetail(a)},null,10,E)))),128)),O]),e.award?(i(),t("div",{key:0,class:"tree-award",onClick:a[4]||(a[4]=a=>e.onBtn("award"))})):n("",!0),o("div",{class:r(["btn-music",{active:e.volume}]),onClick:a[5]||(a[5]=a=>e.onPlayAudio("bgm",!0))},null,2)],2),u(o("div",P,[p(f,{name:"fade"},{default:v((()=>["letter"==e.dialogs?(i(),t("div",{key:0,class:"letter-wrap",onClick:a[10]||(a[10]=C((a=>e.dialogs=""),["self"]))},[o("div",W,[o("span",{class:"letter-link",onClick:a[6]||(a[6]=a=>e.onCardContentLink("letter"))}),o("div",$,[p(w,{value:e.form.content,"onUpdate:value":a[7]||(a[7]=a=>e.form.content=a),placeholder:"请输入心愿"},null,8,["value"])]),o("div",{class:"btn-submit",onClick:a[8]||(a[8]=a=>e.onWishSubmit())})]),o("div",{class:"btn-back",onClick:a[9]||(a[9]=a=>e.dialogs="")})])):n("",!0)])),_:1}),p(f,{name:"fade"},{default:v((()=>["rule"==e.dialogs?(i(),t("div",{key:0,class:"dialogs-rule",onClick:a[12]||(a[12]=C((a=>e.dialogs=""),["self"]))},[o("div",F,[G,H,R,o("div",{class:"btn-go",onClick:a[11]||(a[11]=a=>e.onBtn("letter"))})])])):n("",!0)])),_:1}),p(f,{name:"fade"},{default:v((()=>[-1!==e.dialogs.indexOf("card-")?(i(),t("div",{key:0,class:"dialogs-card",onClick:a[16]||(a[16]=C((a=>e.dialogs=""),["self"]))},[u(o("div",Y,Z,512),[[m,"card-theme"!==e.dialogs]]),u(o("div",J,null,512),[[m,"card-theme"!==e.dialogs]]),o("div",{class:r(["card-content",e.dialogs])},[o("span",{class:"card-content-link",onClick:a[13]||(a[13]=a=>e.onCardContentLink())})],2),"card-theme"==e.dialogs?(i(),t("span",{key:0,class:"btn-go",onClick:a[14]||(a[14]=a=>e.onBtn("letter"))})):(i(),t("span",{key:1,class:"btn-close",onClick:a[15]||(a[15]=a=>e.dialogs="")}))])):n("",!0)])),_:1}),p(f,{name:"fade"},{default:v((()=>["success"==e.dialogs?(i(),t("div",{key:0,class:"dialogs-success",onClick:a[19]||(a[19]=C((a=>e.dialogs=""),["self"]))},[o("div",Q,[V,e.detail?(i(),t("div",X,[o("img",{src:"https://cpe-app-oss.oss-cn-shenzhen.aliyuncs.com/h5/wish/success/202309/"+e.detail.id+".jpg",width:"550"},null,8,ee)])):n("",!0),o("div",ae,[o("span",{class:"btn-go",onClick:a[17]||(a[17]=a=>e.onBtn("letter"))}),o("span",{class:"btn-close",onClick:a[18]||(a[18]=a=>e.dialogs="")})])])])):n("",!0)])),_:1}),p(f,{name:"fade"},{default:v((()=>["record"==e.dialogs?(i(),t("div",{key:0,class:"dialogs-record",onClick:a[21]||(a[21]=C((a=>e.dialogs=""),["self"]))},[o("div",se,[le,o("div",ie,[(i(!0),t(d,null,c(e.recordList,((e,a)=>(i(),t("div",{class:"record-item",key:"record-item-"+a},[o("div",{class:r("title-"+(e.periodNum+7))},null,2),o("div",te,[o("span",oe,x(e.content),1)])])))),128)),0===e.recordList.length?(i(),t("div",de,ce)):n("",!0)]),o("span",{class:"btn-close",onClick:a[20]||(a[20]=a=>e.dialogs="")})])])):n("",!0)])),_:1}),p(f,{name:"fade"},{default:v((()=>[u(o("div",{class:"dialogs-alert",onClick:a[22]||(a[22]=()=>{"submit-success"==e.alert?(e.dialogs="",e.alert=""):e.alert=""})},[o("div",ne,[o("span",{class:r("alert-"+e.alert)},null,2)])],512),[[m,e.alert]])])),_:1}),p(f,{name:"fade"},{default:v((()=>["award"==e.dialogs?(i(),t("div",re,[p(b,{class:"award-name",value:e.form.name,"onUpdate:value":a[23]||(a[23]=a=>e.form.name=a)},null,8,["value"]),p(b,{class:"award-phone",value:e.form.phone,"onUpdate:value":a[24]||(a[24]=a=>e.form.phone=a)},null,8,["value"]),p(w,{class:"award-address",value:e.form.address,"onUpdate:value":a[25]||(a[25]=a=>e.form.address=a)},null,8,["value"]),o("span",{class:"award-submit",onClick:a[26]||(a[26]=a=>e.submitAward())}),o("span",{class:"award-close",onClick:a[27]||(a[27]=a=>e.dialogs="")})])):n("",!0)])),_:1})],512),[[m,e.dialogs||e.alert]]),u(o("div",ue,[(i(!0),t(d,null,c(e.audioList,(e=>(i(),t("audio",{id:"audio-item-"+e.name,key:"audio-item-"+e.name,src:e.src,loop:e.loop??!1},null,8,me)))),128))],512),[[m,!1]]),o("div",{id:"pause",onClick:a[28]||(a[28]=a=>e.showMessage("该板块正在更新中 敬请期待"))})])}],["__scopeId","data-v-1e707f84"]]);export{pe as default};
