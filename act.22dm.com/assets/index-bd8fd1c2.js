import{_ as e,d as a,u as l,r as s,g as n,a as u,w as t,n as i,b as o,e as v,p as c,f as r,h as d,i as m,o as g,c as p,j as f,k as y,l as k,m as h,q as x,T as b,s as T,t as $,F as C,v as M,x as D,y as N,z as S,A as L,B as w,C as U,D as _,E as I,G as E,H as j}from"./index-d8b3cf2b.js";import{w as K}from"./wxjssdk-660da706.js";import{g as A}from"./sign-54d406fa.js";import{s as B,h as V}from"./loading-aa032c9b.js";import{t as X}from"./throttle-b72c38b4.js";import"./isObjectLike-38825d63.js";const Y=e=>(I("data-v-04649530"),e=e(),E(),e),z={key:0,id:"mm",class:"scene-layer bg-mm"},R={class:"mm-top"},W={class:"mm-top-left"},q={class:"mm-top-right"},F=Y((()=>f("div",{class:"icon-mm-title"},null,-1))),G={key:0,id:"game",class:"scene-layer bg-game"},H={class:"target-score topbar-score"},O={class:"game-score topbar-score"},J={class:"topbar-timer"},P={key:0,class:"game-alert icon-alert-timer"},Q={key:1,class:"game-alert icon-alert-miss"},Z={class:"game-hole"},ee=Y((()=>f("div",{class:"icon-hole-0"},null,-1))),ae=Y((()=>f("div",{class:"icon-hole-1"},null,-1))),le=["id"],se=["onClick"],ne=["onClick"],ue={key:0,class:"icon-egg-out"},te={id:"page-dialogs"},ie={class:"gameover-content"},oe={class:"icon-gameover-score"},ve={class:"gameover-score-text"},ce={class:"bg-level"},re={class:"level-need"},de=[Y((()=>f("div",{class:"bg-tips"},null,-1)))],me={key:0,class:"dialogs-pause"},ge={key:0,class:"dialogs-rank bg-rank"},pe=Y((()=>f("span",{class:"icon-rank-title"},null,-1))),fe={class:"rank-list"},ye={class:"rank-item-num"},ke={class:"rank-item-name"},he={class:"rank-item-score"},xe=Y((()=>f("i",{class:h("num-rf")},null,-1))),be={key:0,class:"dialogs-address bg-address"},Te={class:"icon-address"},$e={class:"address-form"},Ce={key:0,id:"audio-list"},Me=["id","src","loop"],De=e(a({__name:"index",setup(e){var a,I;let E,Y,De,Ne="https://cpe-oss-h5.oss-cn-shenzhen.aliyuncs.com/h5/20251002/image-v1";const{proxy:Se}=j();let Le=new K({});const we=l();let Ue="",_e=s({eggUpTime:250,eggStopTime:800,eggDownTime:250,eggTimeDecrease:20,eggTimeMin:300,smashDelay:80,eggScore:10,comboLimit:5,comboScore:10,cicfLevelTime:30,normalLevelTime:50,targetScoreCicf:200,targetScoreNormal:500,targetScoreNormalNextAdd:50,targetScoreNormalMax:3e3,cicfMaxLevel:1,eggNextTime:1e3,eggNextCount:2,eggNextTimeDecrease:100,eggNextTimeMin:300,eggNextCountMax:8,targetSuccessLevel:10,eggAddDelayMin:100,eggAddDelayMax:600,alertDuration:1500,eggScoreMonster:-50,monsterRatio:.2});const Ie=(null==(a=we.params)?void 0:a.userInfo)??{},Ee=s(1),je=s(null==(I=we.meta)?void 0:I.activityKey.includes("-cicf"));De=je.value?"ofN_u6nBbWm3k8KmgyWetjEKIGaE":(null==Ie?void 0:Ie.unionid)??"";const Ke=s(n(je.value?1300:1400,je.value)),Ae=s("mm"),Be=s(""),Ve=s(!1),Xe=s([]),Ye=s(!1),ze=s(!1),Re=s(!1),We=s(1),qe=s(0),Fe=s([]),Ge=s(0),He=s([]),Oe=s(0),Je=s(null),Pe=s(0),Qe=s(0),Ze=s([]),ea=s(!1),aa=s(!1),la=s({phone:"",name:"",address:""});let sa=null,na=null,ua=0,ta=0,ia=0,oa=0,va=0;const ca=u({volume:!1,audioList:[{name:"bgm",src:`${Ne}/audio/bgm.mp3`,loop:!0},{name:"dead",src:`${Ne}/audio/dead.mp3`,loop:!1},{name:"monster",src:`${Ne}/audio/monster.mp3`,loop:!1},{name:"timer",src:`${Ne}/audio/timer.mp3`,loop:!1},{name:"fail",src:`${Ne}/audio/fail.mp3`,loop:!1},{name:"out",src:`${Ne}/audio/out.mp3`,loop:!1},{name:"success",src:`${Ne}/audio/success.mp3`,loop:!1}]});t(Pe,((e,a)=>{je.value||(e>_e.value.comboLimit&&(qe.value+=_e.value.comboScore),0===e&&a>_e.value.comboLimit&&(Be.value||Re.value||(aa.value=!0,setTimeout((()=>{aa.value=!1}),_e.value.alertDuration))))})),t(qe,(e=>{e>=Qe.value&&(je.value&&We.value>=_e.value.cicfMaxLevel?ha():fa())}));const ra=()=>{try{if(Re.value||Be.value)return;if(Ze.value.length<va&&!Re.value){let e=[];for(let a=Ze.value.length;a<va;a++){let a=[];for(let l=1;l<=12;l++)[...Ze.value,...e].some((e=>e.index===l||4===Math.abs(e.index-l)))||a.push(l);if(!(a.length&&e.length+Ze.value.length<va))break;{let l=U(1,3),s=a[U(0,a.length-1)],n=Math.random()<_e.value.monsterRatio,u=_e.value.eggScore;n&&!je.value&&(l=4,u=_e.value.eggScoreMonster),e.push({key:(new Date).getTime(),id:l,index:s,dead:0,score:u,status:0})}}e.length&&(e.forEach((e=>{Ze.value.some((a=>a.index===e.index))||Ze.value.push(e)})),Ze.value=Ze.value.filter(((e,a,l)=>l.findIndex((a=>a.index===e.index))===a)),i((()=>{let e=0;Ze.value.forEach((a=>{if(a&&!a.animationUpData){const l=document.getElementById(`hole-egg-${a.index}`);if(!l)return;const s=[{transform:"translateX(-50%) translateY(100%)"},{transform:"translateX(-50%) translateY(0%)"}],n={duration:ua,iterations:1,easing:"linear",fill:"forwards"};a.animationUpData=[s,n],e+=U(_e.value.eggAddDelayMin,_e.value.eggAddDelayMax),setTimeout((()=>{l.style.willChange="transform",l.style.backfaceVisibility="hidden",l.style.webkitBackfaceVisibility="hidden";const e=l.animate(s,n);a.animationUp=e,a.status=1,e.onfinish=()=>{a.dead||(a.status=2,ga(a))},Ve.value&&e.pause()}),e)}}))})))}}catch(e){}},da=X(ra,50),ma=(e,a,l=0)=>{var s,n;try{if(null===a){const e=Ze.value.find((e=>e.index===l&&!e.dead&&3!==e.status));if(!e)return;a=e}if(a.dead)return;1===a.status&&(null==(n=null==(s=a.animationUp)?void 0:s.cancel)||n.call(s)),a.dead=4===a.id?4:Math.random()>.5?1:2,qe.value+=a.score,a.score<0?(Pe.value=0,Ca("monster")):(Pe.value++,Ca("dead")),qe.value=qe.value<0?0:qe.value,ga(a,!0),pa(e)}catch(u){}},ga=(e,a=!1)=>{try{setTimeout((()=>{if(a||!a&&!e.dead){if(!Ze.value.some((a=>a.index===e.index&&a.key===e.key)))return;if(!e.animationDown){const a=document.getElementById(`hole-egg-${e.index}`);if(!a)return;const l=a.animate([{transform:"translateX(-50%) translateY(100%)"}],{duration:ia,iterations:1,easing:"linear",fill:"forwards"});e.animationDown=l,e.status=3,l.onfinish=()=>{e.dead||4===e.id||(Pe.value=0);const a=Ze.value.indexOf(e);a>-1&&Ze.value.splice(a,1),setTimeout((()=>{da()}),100)},Ve.value&&l.pause()}}}),a?0:ta)}catch(l){}},pa=e=>{try{let{pageX:a,pageY:l}=e;const{left:s,top:n}=sa.getBoundingClientRect();je.value&&(a/=Ee.value,l/=Ee.value);let u=50*Ke.value;je.value?Je.value={left:a-s,top:l-n-2*u}:Je.value={left:l-n,top:750-a-2*u},setTimeout((()=>{Je.value=null}),_e.value.smashDelay)}catch(a){}},fa=(e=!1)=>{Ze.value=[],e?(We.value=1,Fe.value=[],He.value=[],Qe.value=je.value?_e.value.targetScoreCicf:_e.value.targetScoreNormal,ua=_e.value.eggUpTime,ta=_e.value.eggStopTime,ia=_e.value.eggDownTime,oa=_e.value.eggNextTime,va=_e.value.eggNextCount):(He.value.push((je.value?_e.value.cicfLevelTime:_e.value.normalLevelTime)-Ge.value),Fe.value.push(qe.value),We.value++,Qe.value+=_e.value.targetScoreNormalNextAdd,Pe.value=0,ua-=_e.value.eggTimeDecrease,ta-=_e.value.eggTimeDecrease,ia-=_e.value.eggTimeDecrease,oa-=_e.value.eggNextTimeDecrease,va+=.4,va=Math.floor(va),Qe.value=Qe.value>_e.value.targetScoreNormalMax?_e.value.targetScoreNormalMax:Qe.value,ua=ua<_e.value.eggTimeMin?_e.value.eggTimeMin:ua,ta=ta<_e.value.eggTimeMin?_e.value.eggTimeMin:ta,ia=ia<_e.value.eggTimeMin?_e.value.eggTimeMin:ia,oa=oa<_e.value.eggNextTimeMin?_e.value.eggNextTimeMin:oa,va=va>_e.value.eggNextCountMax?_e.value.eggNextCountMax:va),Ge.value=je.value?_e.value.cicfLevelTime:_e.value.normalLevelTime,qe.value=0,Ve.value=!1,Ae.value="game",Re.value=!1,je.value?setTimeout((()=>{ya()}),1e3):Be.value="level",i((()=>{sa=document.getElementById("game")}))},ya=()=>{Be.value="",ka(),ra()},ka=()=>{na&&clearInterval(na),na=null,Ge.value=je.value?_e.value.cicfLevelTime:_e.value.normalLevelTime,na=setInterval((()=>{Be.value||(Ge.value--,11===Ge.value&&(Ca("timer"),Be.value||Re.value||(ea.value=!0,setTimeout((()=>{ea.value=!1}),_e.value.alertDuration)))),Ge.value<=0&&(na&&clearInterval(na),na=null,ha())}),1e3)},ha=()=>{try{na&&clearInterval(na),na=null,Re.value=!0,Ze.value=[],He.value.push((je.value?_e.value.cicfLevelTime:_e.value.normalLevelTime)-Ge.value),Fe.value.push(qe.value),Oe.value=Fe.value.reduce(((e,a)=>e+a),0);const e=He.value.reduce(((e,a)=>e+a),0);let a=We.value,l=Oe.value;const s={};je.value?Be.value=l>=_e.value.targetScoreCicf?"gameover-success":"gameover-fail":Be.value=a>=_e.value.targetSuccessLevel?"gameover-success":"gameover-fail";let n=A({k:Ue,unionid:De,score:l,level:a});o({ownerUnionid:De,activityKey:E,gameScore:l,levelNum:a,playTime:e,k:Ue,s:n,extra:s}).then((()=>{Ta()})),Ca("gameover-success"===Be.value?"success":"fail")}catch(e){}},xa=e=>{Be.value=e,"pause"===e&&(Ve.value=!0,Ze.value.forEach((e=>{var a,l,s,n;1===e.status?null==(l=null==(a=e.animationUp)?void 0:a.pause)||l.call(a):3===e.status&&(null==(n=null==(s=e.animationDown)?void 0:s.pause)||n.call(s))})))},ba=e=>{Be.value="",Ve.value=!1,1===e?Ae.value="mm":2===e&&Ze.value.forEach((e=>{var a,l,s,n;1===e.status?null==(l=null==(a=e.animationUp)?void 0:a.play)||l.call(a):3===e.status&&(null==(n=null==(s=e.animationDown)?void 0:s.play)||n.call(s))}))},Ta=()=>{v({activityKey:E,periodNum:Y,unionid:De,k:Ue,endTime:"2025-11-01 00:00:00",rankSize:10}).then((({code:e,data:a})=>{0===e&&(Xe.value=a)}))},$a=e=>{Se.$Message.success(e)},Ca=(e,a=!1)=>{c(ca,e,a)};return r((async()=>{var e,a;B("加载中...",je.value?0:90),E=(null==(e=we.meta)?void 0:e.activityKey)??"20251002",Y=(null==(a=we.meta)?void 0:a.periodNum)??1;const{innerWidth:l,innerHeight:s}=window;if(je.value&&l>1600){let e=l/1200,a=s/750;Ee.value=e<a?e:a}d({activityKey:E}).then((({code:e,data:a})=>{0===e&&(Ue=a.k,a.extra&&(_e.value=a.extra),Ta())})).finally((()=>{V()})),je.value||Le.ready((()=>{var e,a,l;Ca("bgm",!0),Le.updateShareData({title:(null==(e=we.meta)?void 0:e.title)??"",desc:(null==(a=we.meta)?void 0:a.desc)??"",link:location.origin+we.path,imgUrl:(null==(l=we.meta)?void 0:l.imgUrl)??""}),document.addEventListener("visibilitychange",(e=>{document.hidden?m():ca.volume&&Ca("bgm",!0)}))}))})),(e,a)=>(g(),p(C,null,[f("div",{id:"page-20251002",class:h({m:!je.value,isCICF:je.value}),style:T(`scale:${Ee.value}`)},[y(b,{name:"fade"},{default:k((()=>["mm"==Ae.value?(g(),p("div",z,[f("div",R,[f("div",W,[f("span",{class:h(["btn-music",[{active:ca.volume}]]),onClick:a[0]||(a[0]=e=>Ca("bgm",!0))},null,2)]),f("div",q,[f("span",{class:"btn-rule",onClick:a[1]||(a[1]=e=>xa("rule"))}),je.value?x("",!0):(g(),p("span",{key:0,class:"btn-rank",onClick:a[2]||(a[2]=e=>xa("rank"))}))])]),F,f("div",{class:"btn-start",onClick:a[3]||(a[3]=e=>fa(!0))})])):x("",!0)])),_:1}),y(b,{name:"fade"},{default:k((()=>["game"==Ae.value?(g(),p("div",G,[f("span",{class:"icon-game-left",style:T(`scale:${$(n)(1600,je.value)}`),onClick:a[4]||(a[4]=e=>xa("pause"))},null,4),f("span",{class:"icon-game-right",style:T(`scale:${$(n)(1400,je.value)}`)},null,4),f("div",{id:"game-top-info",class:"bg-topbar",style:T(`scale:${$(n)(1100,je.value)}`)},[f("div",H,[(g(!0),p(C,null,M(Qe.value+"",((e,a)=>(g(),p("span",{key:"topbar-target-score-"+a,class:h(`num-${e}-s`)},null,2)))),128))]),f("div",O,[(g(!0),p(C,null,M(qe.value+"",((e,a)=>(g(),p("span",{key:"topbar-game-score-"+a,class:h(`num-${e}-s`)},null,2)))),128))]),f("div",J,[(g(!0),p(C,null,M(Ge.value+"",((e,a)=>(g(),p("span",{key:"topbar-game-time-"+a,class:h(`num-${e}-s`)},null,2)))),128))])],4),f("span",{class:"btn-pause",onClick:a[5]||(a[5]=e=>xa("pause"))}),ea.value?(g(),p("div",P)):x("",!0),aa.value?(g(),p("div",Q)):x("",!0),f("div",{id:"game-hole-list",style:T(`scale:${$(n)(1100,je.value)}`),onContextmenu:a[6]||(a[6]=D((()=>{}),["prevent"])),onSelectstart:a[7]||(a[7]=D((()=>{}),["prevent"])),onDragstart:a[8]||(a[8]=D((()=>{}),["prevent"])),class:h({"touch-disabled":je.value})},[(g(),p(C,null,M(12,(e=>f("div",{class:"game-hole-box",key:"hole-"+e},[f("div",Z,[ee,ae,f("div",{class:h(["game-hole-role",{hasEgg:Ze.value.some((a=>a.index===e))}])},[(g(!0),p(C,null,M(Ze.value,(a=>(g(),p(C,{key:`egg-${a.index}-${a.key}`},[e===a.index?(g(),p("div",{key:0,class:h(["hole-egg",[`icon-egg-${a.id}`,{dead:a.dead},`icon-dead-${a.dead}`]]),id:"hole-egg-"+a.index},[e===a.index?(g(),p("div",{key:0,class:"hole-egg-click",onClick:e=>ma(e,a)},null,8,se)):x("",!0)],10,le)):x("",!0)],64)))),128))],2),f("div",{class:"icon-hole-2",onClick:a=>ma(a,null,e)},null,8,ne),Ze.value.some((a=>a.index===e&&a.dead&&4!==a.id))?(g(),p("div",ue)):x("",!0)])]))),64))],38),Je.value?(g(),p("div",{key:2,class:"icon-smash",style:T(`top:${Je.value.top}px;left:${Je.value.left}px;scale:${Ke.value};`)},null,4)):x("",!0)])):x("",!0)])),_:1}),N(f("div",te,[y(b,{name:"fade"},{default:k((()=>["rule"===Be.value?(g(),p("div",{key:0,class:"dialogs-rule",onClick:a[9]||(a[9]=D((e=>xa("")),["stop"]))},[f("div",{class:"bg-rule",style:T(`transform:scale(${Ke.value})`)},null,4)])):x("",!0)])),_:1}),y(b,{name:"fade"},{default:k((()=>[["gameover-success","gameover-fail"].includes(Be.value)?(g(),p("div",{key:0,class:h(["dialogs-gameover",`bg-${Be.value}`])},[f("div",{class:h(["gameover-box",`icon-${Be.value}`]),style:T(`transform:scale(${Ke.value})`)},[f("div",ie,[f("span",{class:"btn-back",onClick:a[10]||(a[10]=e=>ba(1))}),f("div",oe,[f("div",ve,[(g(!0),p(C,null,M(Oe.value+"",((e,a)=>(g(),p("span",{key:"gameover-score-"+a,class:h(`num-${e}-s`)},null,2)))),128))])])])],6)],2)):x("",!0)])),_:1}),y(b,{name:"fade"},{default:k((()=>["level"===Be.value?(g(),p("div",{key:0,class:"dialogs-level",onClick:a[11]||(a[11]=e=>je.value||1!==We.value?ya():xa("tips"))},[f("div",ce,[f("div",re,[(g(!0),p(C,null,M(Qe.value+"",((e,a)=>(g(),p("span",{key:"target-score-"+a,class:h(`num-${e}`)},null,2)))),128))])])])):x("",!0)])),_:1}),y(b,{name:"fade"},{default:k((()=>["tips"===Be.value?(g(),p("div",{key:0,class:"dialogs-tips",onClick:a[12]||(a[12]=e=>ya())},de)):x("",!0)])),_:1}),y(b,{name:"fade"},{default:k((()=>["pause"===Be.value?(g(),p("div",me,[f("div",{class:"bg-pause",style:T(`transform:scale(${Ke.value})`)},[f("span",{class:"pause-reset",onClick:a[13]||(a[13]=e=>ba(1))}),f("span",{class:"pause-continue",onClick:a[14]||(a[14]=e=>ba(2))})],4)])):x("",!0)])),_:1}),y(b,{name:"fade"},{default:k((()=>["rank"===Be.value?(g(),p("div",ge,[f("div",{class:"bg-rank-list",style:T(`transform:scale(${Ke.value})`)},[pe,f("div",fe,[(g(!0),p(C,null,M(Xe.value,((e,a)=>{var l;return g(),p("span",{class:"rank-item icon-rank-item",key:"rank-item-"+a},[f("span",ye,[f("i",{class:h(`num-r${a+1}`)},null,2)]),f("span",ke,L((null==(l=e.userInfo)?void 0:l.nickname)??""),1),f("span",he,[(g(!0),p(C,null,M(e.gameScore+"",((e,l)=>(g(),p("i",{key:"rank-"+a+"-score-"+l,class:h(`num-${e}-ss`)},null,2)))),128)),xe])])})),128))]),f("span",{class:"btn-back",onClick:a[15]||(a[15]=e=>xa(""))})],4)])):x("",!0)])),_:1}),y(b,{name:"fade"},{default:k((()=>["address"===Be.value?(g(),p("div",be,[f("div",Te,[f("div",$e,[N(f("input",{class:"address-name","onUpdate:modelValue":a[16]||(a[16]=e=>la.value.name=e),autocomplete:"off",name:"name"},null,512),[[w,la.value.name]]),N(f("input",{class:"address-phone","onUpdate:modelValue":a[17]||(a[17]=e=>la.value.phone=e),autocomplete:"off",name:"phone"},null,512),[[w,la.value.phone]]),N(f("input",{class:"address-address","onUpdate:modelValue":a[18]||(a[18]=e=>la.value.address=e),autocomplete:"off",name:"address"},null,512),[[w,la.value.address]])]),f("span",{class:"btn-back",onClick:a[19]||(a[19]=e=>xa(""))}),f("span",{class:"btn-submit",onClick:a[20]||(a[20]=e=>(()=>{let{phone:e,name:a,address:l}=la.value,s={};if(a&&e&&l&&!Ye.value)if(11==e.length){if(ze.value)return;ze.value=!0,B("提交中..."),_({activityKey:E,periodNum:Y,ownerUnionid:De,address:l,name:a,phone:e,extra:s}).then((()=>{$a("提交成功"),Be.value="",Ye.value=!0})).finally((()=>{ze.value=!1,V()}))}else $a("请填写11位手机号码");else $a("请输入正确的信息")})())})])])):x("",!0)])),_:1})],512),[[S,Be.value]])],6),ca.audioList.length?N((g(),p("div",Ce,[(g(!0),p(C,null,M(ca.audioList,(e=>(g(),p("audio",{id:"audio-item-"+e.name,key:"audio-item-"+e.name,src:e.src,loop:e.loop??!1},null,8,Me)))),128))],512)),[[S,!1]]):x("",!0)],64))}}),[["__scopeId","data-v-04649530"]]);export{De as default};
