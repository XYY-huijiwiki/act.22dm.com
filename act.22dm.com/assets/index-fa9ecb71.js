import{ae as e,_ as a,d as s,Z as l,o as t,c as i,j as o,F as d,m as c,l as n,n as r,q as u,v as m,x as p,y as v,T as f,u as h,b as g,f as y,p as b,a1 as w,w as k,t as C,af as x,K as M,O as _,P as L,Q as U}from"./index-a30d4970.js";import{w as j}from"./wxjssdk-dcef36f2.js";import{T as I,I as A}from"./index-6dd37c9d.js";import"./isObjectLike-38825d63.js";let B="/h5/activity";let q,D="wishTree",T=5;const z=s({name:"drift-bottle",components:{Textarea:I,Input:A},setup(a,s){var l,t;const{proxy:i}=U();let o=new j({});const d=h(),c=g({loading:!1,volume:!1,award:!1,awardDetail:null,dialogs:"",alert:"",wishTreeList:[{id:4,color:"red",type:"ing"},{id:5,color:"yellow",type:"success"},{id:3,color:"red",type:"ing"},{id:6,color:"yellow",type:"success"},{id:7,color:"yellow",type:"success"},{id:2,color:"blue",type:"finish"},{id:8,color:"yellow",type:"success"},{id:1,color:"blue",type:"finish"},{id:9,color:"yellow",type:"success"},{id:10,color:"yellow",type:"success"},{id:11,color:"yellow",type:"success"},{id:12,color:"yellow",type:"success"},{id:13,color:"yellow",type:"success"},{id:14,color:"empty",type:"empty"},{id:15,color:"empty",type:"empty"}],recordList:[],detail:{id:5,color:"yellow",type:"success"},form:{content:"",name:"",phone:"",address:""},userInfo:(null==(l=d.params)?void 0:l.userInfo)??{},audioList:[{name:"bgm",src:"https://cpe-app-oss.oss-cn-shenzhen.aliyuncs.com/h5/wish/bgm1.mp3",loop:!0}]});q=(null==(t=c.userInfo)?void 0:t.unionid)??"";const n=e=>{if("award"===e){if(c.awardDetail)return void(c.alert="你已填写过信息")}else"card-theme"===e?p("近期暂无活动"):c.dialogs=e},r=()=>{var a;(a={ownerUnionid:q,activityKey:D,periodNum:T},e({url:B+`/wish-tree/list?ownerUnionid=${a.ownerUnionid}`,method:"post",data:a})).then((({code:e,data:a})=>{0===e&&(T=a.periodNum,D=a.activityKey)}))},u=()=>{var a;(a={ownerUnionid:q},e({url:B+"/wish-tree/records?ownerUnionid="+a.ownerUnionid,method:"post",data:a})).then((({code:e,data:a})=>{0===e&&(c.recordList=a.wishTreeList.filter((e=>{if(2==e.wishType&&(0==e.wishStatus||3==e.wishStatus)&&e.periodNum>=T)return e})))}))},m=(e,a=!1)=>{try{if(a&&(c.volume=!c.volume,c.volume||b()),c.volume){let a=document.getElementById("audio-item-"+e);a.paused&&a.play()}}catch(s){}},p=e=>{i.$Message.success(e)};return y((()=>{var e,a;if(r(),u(),null==(e=d.query)?void 0:e.type){n(["","record","letter","card-theme","rule"][1*d.query.type])}let s=location.origin+d.path,l=(null==(a=d.meta)?void 0:a.imgUrl)??"";o.ready((()=>{var e,a;m("bgm",!0),o.updateShareData({title:(null==(e=d.meta)?void 0:e.title)??"",desc:(null==(a=d.meta)?void 0:a.desc)??"",link:s,imgUrl:l}),document.addEventListener("visibilitychange",(e=>{document.hidden?b():c.volume&&m("bgm")}))}))})),{...w(c),onStarDetail:e=>{let{id:a}=e;switch(a){case 1:c.dialogs="card-xi";break;case 2:c.dialogs="card-mei";break;case 3:c.dialogs="card-nuan";break;case 4:c.dialogs="card-lan";break;case 14:case 15:c.dialogs="letter";break;default:c.detail=e,c.dialogs="success"}},onBtn:n,onWishSubmit:()=>{if(c.loading)return;if(c.recordList.filter((e=>e.periodNum==T)).length<1){let s=c.form.content;if(x(s)){c.loading=!0,(a={periodNum:T,ownerUnionid:q,content:s},e({url:B+"/wish-tree/submit",method:"post",data:a})).then((({code:e,data:a})=>{0===e&&(c.dialogs="",c.form.content="",c.alert="submit-success",u())})).catch((e=>{c.alert="submit-0"})).finally((()=>{c.loading=!1}))}else c.alert="submit-empty"}else c.alert="submit-0";var a},onCardContentLink:(e="")=>{"letter"==e&&(c.dialogs="card-theme"),"card-xi"==c.dialogs?location.href="https://mp.weixin.qq.com/s?__biz=MjM5MDAxMzI0MA==&mid=2649622435&idx=1&sn=675995ccff783286d4efc629be6706a1&chksm=be51e5f489266ce249529aa7449cb0f490dc81f5b3b044a19865313793acf1c4a3e1c19b0514#rd":"card-fei"==c.dialogs?location.href="https://mp.weixin.qq.com/s?__biz=MjM5MDAxMzI0MA==&mid=2649612015&idx=1&sn=8dff45a3261c9cbd4c8aa9a2046a648b&chksm=be523cb88925b5ae3ed8079b78d277ba3304b8fbac7e5bc699af38c26724753fe9e55eecfc33#rd":"card-mei"==c.dialogs?c.alert="shop":"card-lan"==c.dialogs&&(location.href="https://mp.weixin.qq.com/s?__biz=MjM5MDAxMzI0MA==&mid=2649613789&idx=1&sn=dd59068449e6fece5dc1c86d9463a8de&chksm=be52078a89258e9cc89e6cf577d29ec44b6afa06073e698bf9b00d7f347c019060d0e10cdbe6#rd")},onPlayAudio:m,submitAward:()=>{let{name:e,phone:a,address:s}=c.form;e&&a&&s?11==a.length?M({activityKey:"bottleReward",periodNum:T-1,ownerUnionid:q,address:s,name:e,phone:a,extra:{activityKey:D}}).then((()=>{c.alert="提交成功",c.dialogs="",c.awardDetail={address:s,name:e,phone:a}})):c.alert="请填写11位手机号码":c.alert="请输入正确的信息"},showMessage:p}}}),S=e=>(_("data-v-9eee1906"),e=e(),L(),e),N={id:"page-wish"},K={class:"wish-btn"},O={class:"tree-main"},P=["onClick"],E=S((()=>o("span",{class:"tree-role"},null,-1))),W={class:"page-dialogs"},$={key:0,class:"letter-wrap"},F={class:"letter-content"},Q={class:"letter-text"},R={class:"rule-wrap"},Z=S((()=>o("div",{class:"title-rule"},null,-1))),G=S((()=>o("div",{class:"rule-tips"},null,-1))),H=S((()=>o("div",{class:"rule-content"},null,-1))),J={class:"card-ufo"},V=[S((()=>o("span",{class:"card-star"},null,-1)))],X={class:"card-flower"},Y={class:"success-wrap"},ee=S((()=>o("div",{class:"title-success"},null,-1))),ae={key:0,class:"success-content"},se=["src"],le={class:"success-btn"},te={class:"record-wrap"},ie=S((()=>o("div",{class:"title-record"},null,-1))),oe={class:"record-list"},de={class:"record-content"},ce={class:"record-content-text"},ne={key:0,class:"record-item"},re=[S((()=>o("div",{class:"record-content"},[o("span",{class:"alert-empty"})],-1)))],ue={class:"alert-main"},me={key:0,class:"dialogs-award"},pe={id:"audio-list"},ve=["id","src","loop"];const fe=a(z,[["render",function(e,a,s,h,g,y){const b=l("Textarea"),w=l("Input");return t(),i("div",N,[o("div",{class:r(["wish-tree",{filter:e.dialogs||e.alert}])},[o("div",K,[o("span",{class:"btn-record",onClick:a[0]||(a[0]=a=>e.onBtn("record"))}),o("span",{class:"btn-wish",onClick:a[1]||(a[1]=a=>e.onBtn("letter"))}),o("span",{class:"btn-theme2",onClick:a[2]||(a[2]=a=>e.onBtn("card-theme"))}),o("span",{class:"btn-rule",onClick:a[3]||(a[3]=a=>e.onBtn("rule"))})]),o("div",O,[(t(!0),i(d,null,c(e.wishTreeList,((a,s)=>(t(),i("span",{key:"star-"-s,class:r(["star-"+a.color,"position-"+(s+1)]),onClick:s=>e.onStarDetail(a)},null,10,P)))),128)),E]),e.award?(t(),i("div",{key:0,class:"tree-award",onClick:a[4]||(a[4]=a=>e.onBtn("award"))})):n("",!0),o("div",{class:r(["btn-music",{active:e.volume}]),onClick:a[5]||(a[5]=a=>e.onPlayAudio("bgm",!0))},null,2)],2),u(o("div",W,[p(f,{name:"fade"},{default:v((()=>["letter"==e.dialogs?(t(),i("div",$,[o("div",F,[o("div",Q,[p(b,{value:e.form.content,"onUpdate:value":a[6]||(a[6]=a=>e.form.content=a),placeholder:"请输入心愿"},null,8,["value"])]),o("div",{class:"btn-submit",onClick:a[7]||(a[7]=a=>e.onWishSubmit())})]),o("div",{class:"btn-back",onClick:a[8]||(a[8]=a=>e.dialogs="")})])):n("",!0)])),_:1}),p(f,{name:"fade"},{default:v((()=>["rule"==e.dialogs?(t(),i("div",{key:0,class:"dialogs-rule",onClick:a[10]||(a[10]=k((a=>e.dialogs=""),["self"]))},[o("div",R,[Z,G,H,o("div",{class:"btn-go",onClick:a[9]||(a[9]=a=>e.onBtn("letter"))})])])):n("",!0)])),_:1}),p(f,{name:"fade"},{default:v((()=>[-1!==e.dialogs.indexOf("card-")?(t(),i("div",{key:0,class:"dialogs-card",onClick:a[14]||(a[14]=k((a=>e.dialogs=""),["self"]))},[u(o("div",J,V,512),[[m,"card-theme"!==e.dialogs]]),u(o("div",X,null,512),[[m,"card-theme"!==e.dialogs]]),o("div",{class:r(["card-content",e.dialogs])},[o("span",{class:"card-content-link",onClick:a[11]||(a[11]=a=>e.onCardContentLink())})],2),"card-theme"==e.dialogs?(t(),i("span",{key:0,class:"btn-go",onClick:a[12]||(a[12]=a=>e.onBtn("letter"))})):(t(),i("span",{key:1,class:"btn-close",onClick:a[13]||(a[13]=a=>e.dialogs="")}))])):n("",!0)])),_:1}),p(f,{name:"fade"},{default:v((()=>["success"==e.dialogs?(t(),i("div",{key:0,class:"dialogs-success",onClick:a[17]||(a[17]=k((a=>e.dialogs=""),["self"]))},[o("div",Y,[ee,e.detail?(t(),i("div",ae,[o("img",{src:"https://cpe-app-oss.oss-cn-shenzhen.aliyuncs.com/h5/wish/success/202309/"+e.detail.id+".jpg",width:"550"},null,8,se)])):n("",!0),o("div",le,[o("span",{class:"btn-go",onClick:a[15]||(a[15]=a=>e.onBtn("letter"))}),o("span",{class:"btn-close",onClick:a[16]||(a[16]=a=>e.dialogs="")})])])])):n("",!0)])),_:1}),p(f,{name:"fade"},{default:v((()=>["record"==e.dialogs?(t(),i("div",{key:0,class:"dialogs-record",onClick:a[19]||(a[19]=k((a=>e.dialogs=""),["self"]))},[o("div",te,[ie,o("div",oe,[(t(!0),i(d,null,c(e.recordList,((e,a)=>(t(),i("div",{class:"record-item",key:"record-item-"+a},[o("div",de,[o("span",ce,C(e.content),1)])])))),128)),0===e.recordList.length?(t(),i("div",ne,re)):n("",!0)]),o("span",{class:"btn-close",onClick:a[18]||(a[18]=a=>e.dialogs="")})])])):n("",!0)])),_:1}),p(f,{name:"fade"},{default:v((()=>[u(o("div",{class:"dialogs-alert",onClick:a[20]||(a[20]=()=>{"submit-success"==e.alert?(e.dialogs="",e.alert=""):e.alert=""})},[o("div",ue,[o("span",{class:r("alert-"+e.alert)},null,2)])],512),[[m,e.alert]])])),_:1}),p(f,{name:"fade"},{default:v((()=>["award"==e.dialogs?(t(),i("div",me,[p(w,{class:"award-name",value:e.form.name,"onUpdate:value":a[21]||(a[21]=a=>e.form.name=a)},null,8,["value"]),p(w,{class:"award-phone",value:e.form.phone,"onUpdate:value":a[22]||(a[22]=a=>e.form.phone=a)},null,8,["value"]),p(b,{class:"award-address",value:e.form.address,"onUpdate:value":a[23]||(a[23]=a=>e.form.address=a)},null,8,["value"]),o("span",{class:"award-submit",onClick:a[24]||(a[24]=a=>e.submitAward())}),o("span",{class:"award-close",onClick:a[25]||(a[25]=a=>e.dialogs="")})])):n("",!0)])),_:1})],512),[[m,e.dialogs||e.alert]]),u(o("div",pe,[(t(!0),i(d,null,c(e.audioList,(e=>(t(),i("audio",{id:"audio-item-"+e.name,key:"audio-item-"+e.name,src:e.src,loop:e.loop??!1},null,8,ve)))),128))],512),[[m,!1]])])}],["__scopeId","data-v-9eee1906"]]);export{fe as default};
