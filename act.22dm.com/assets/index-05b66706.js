import{_ as e,d as l,u as a,Y as s,r as i,g as u,b as o,e as c,f as n,h as v,p as d,o as t,c as m,j as r,n as y,F as p,m as g,w as k,l as f,q as $,v as b,z as w,x as C,y as h,T as x,C as T,J as _,D as S,N as I,Q as K,O as N,P as j}from"./index-19ecc65e.js";import{w as L}from"./wxjssdk-9b84c5c1.js";import{g as U}from"./sign-54d406fa.js";import{g as G,a as q}from"./utils-ca8022a5.js";const z={class:"game-key page-layer"},D=["onClick"],E=["onClick"],O=["onClick"],W={class:"game-top-info"},B={class:"icon-topbar-game"},F={class:"icon-topbar-prize"},H={class:"game-timer"},J={class:"key-box"},M=["onClick"],P={id:"page-dialogs"},Q={key:0,class:"dialogs-eye"},Y={key:0,class:"dialogs-eye"},A={class:"bg-rule-1"},R={class:"bg-rule-scroll"},V={key:0,class:"bg-rule-2"},X=[(e=>(N("data-v-7359bb6a"),e=e(),j(),e))((()=>r("div",{class:"bg-empty"},null,-1)))],Z={id:"audio-list"},ee=["id","src","loop"],le=e(l({__name:"index",setup(e){var l,N;let j,le,ae,se,ie="",ue="",oe=new L({}),ce=null,ne="https://cpe-app-oss.oss-cn-shenzhen.aliyuncs.com/h5/0109-key/image-vvv";const{proxy:ve}=K(),de=a(),te=s(),me=(null==(l=de.params)?void 0:l.userInfo)??{};ae=(null==me?void 0:me.unionid)??"";const re=i({timeLimit:40,delaySuccessTime:500,successGetScore:50,failGetScore:25,eyeTime:500,eyeTime2:800,whiteList:["ofN_u6nBbWm3k8KmgyWetjEKIGaE"]}),ye=i(window.innerHeight>1.5*window.innerWidth),pe=i(!1),ge=i(u(1200)),ke=i(""),fe=i("rule"),$e=i([]),be=i(40),we=i(0),Ce=i(10),he=i(!1),xe=i([]),Te=i([]),_e=i((null==(N=null==de?void 0:de.query)?void 0:N.skinId)??""),Se=o({imgUrl:ne,volume:!1,audioList:[{name:"bgm",src:`${ne}/audio/bgm.mp3`,loop:!0},{name:"find",src:`${ne}/audio/find.mp3`,loop:!1},{name:"foot",src:`${ne}/audio/foot.mp3`,loop:!1},{name:"key",src:`${ne}/audio/key.mp3`,loop:!1},{name:"success",src:`${ne}/audio/success.mp3`,loop:!1},{name:"timer",src:`${ne}/audio/timer.mp3`,loop:!1},{name:"word-1",src:`${ne}/audio/word-1.mp3`,loop:!1}]}),Ie=c((()=>{const e=G($e.value);return{gameCount:q($e.value),scoreCount:e}})),Ke=c((()=>{const e=be.value;let l=180===e?3:e>=120?2:e>=60?1:0,a=(e-60*l+"").split("");return`${l}d${1===a.length?"0":a[0]}${1===a.length?a[0]:a[1]}`.split("")})),Ne=()=>{we.value=T(1,10),ce&&clearInterval(ce),be.value=re.value.timeLimit,xe.value=[],Te.value=[],he.value=!1,Ce.value=0,ke.value="",fe.value="2"===_e.value?"word-3":"word-1"},je=(e,l="")=>{if("rule-close"===e)Ne();else if("word-close"===e){let e=fe.value.split("word-")[1];e*=1,e<=3?3===e?(fe.value="",ce=setInterval((()=>{fe.value||be.value--,0===be.value?(ce&&clearInterval(ce),Ue("fail")):10===be.value&&qe("timer")}),1e3),Ge({type:"game-play",activityKey:j})):fe.value="word-"+(1*e+1):4===e&&Le()}else if("special"===e)qe("key"),fe.value="word-4";else if("find"===e){if(Te.value.includes(l)||(Te.value.push(l),qe("find")),xe.value.includes(l)){const e=xe.value.findIndex((e=>e===l));-1!==e&&xe.value.splice(e,1)}else xe.value=[l];4===l&&qe("foot")}else if("close-tips"===e){if(l&&1!==l&&xe.value.includes(l)){const e=xe.value.findIndex((e=>e===l));-1!==e&&xe.value.splice(e,1)}}else"game-key"===e?l!==Ce.value||he.value||(he.value=!0,ce&&clearInterval(ce),setTimeout((()=>{Ue("success")}),re.value.delaySuccessTime)):"close-eye"===e?"eye-1"===l?(fe.value="eye-2",setTimeout((()=>{je("close-eye",fe.value)}),re.value.eyeTime2)):"eye-2"===l&&(fe.value="fail"):"close-success"===e||"close-fail"===e?Ie.value.gameCount>0?Ne():fe.value="empty":"close-empty"===e?te.go(-1):"close-game"===e&&(ke.value="")},Le=()=>{fe.value="",ke.value="game",xe.value=[],he.value=!1,Ce.value=T(1,44)},Ue=e=>{fe.value="success"===e?"success":"eye-1";const l="success"===e?1:0,a=re.value.timeLimit-be.value,s="success"===e?re.value.successGetScore:re.value.failGetScore;"success"===e?qe("success"):(qe("word-1"),setTimeout((()=>{je("close-eye",fe.value)}),re.value.eyeTime)),Ge({type:"game-play-0109-key",getScore:s,gameScore:l,playTime:a}),_({ownerUnionid:ae,activityKey:j,gameScore:l,levelNum:0,playTime:a,k:ie,s:U({k:ie,unionid:ae,score:l,level:0})})},Ge=(e={})=>{let l=U({k:ue,unionid:ae,score:0,level:0});const a=(new Date).getTime();$e.value.push({addTime:a,extra:{...e}}),_({ownerUnionid:ae,activityKey:se,gameScore:0,levelNum:0,playTime:a,extra:e,k:ue,s:l})},qe=(e,l=!1)=>{I(Se,e,l)};return n((()=>{var e,l,a;j=(null==(e=de.meta)?void 0:e.activityKey)??"0109-key",se=(null==(l=de.meta)?void 0:l.activityKey0109)??"0109",le=(null==(a=de.meta)?void 0:a.periodNum)??1,pe.value=!0,v({activityKey:j,periodNum:le}).then((({code:e,data:l})=>{var a;0===e?(ie=l.k,l.extra&&(re.value=l.extra),S({activityKey:se,periodNum:le,ownerUnionid:ae}).then((({code:e,data:l})=>{0===e&&($e.value=l)}))):(a="活动初始化异常,请刷新后再试",ve.$Message.success(a))})).finally((()=>{pe.value=!1})),v({activityKey:se,periodNum:le}).then((({code:e,data:l})=>{0===e&&(ue=l.k)})),oe.ready((()=>{var e,l,a;qe("bgm",!0),oe.updateShareData({title:(null==(e=de.meta)?void 0:e.title)??"",desc:(null==(l=de.meta)?void 0:l.desc)??"",link:location.origin+de.path,imgUrl:(null==(a=de.meta)?void 0:a.imgUrl)??""}),document.addEventListener("visibilitychange",(e=>{document.hidden?d():Se.volume&&qe("bgm",!0)}))}))})),(e,l)=>(t(),m(p,null,[r("div",{id:"page-0109-key",class:y({m:ye.value})},[r("div",{id:"page-game",class:y(["page-layer",{dialogs:ke.value||fe.value}])},[r("div",{class:y(`bg-game-${we.value}${_e.value}`)},[r("div",z,[(t(),m(p,null,g(6,(e=>r("span",{key:`icon-key-${e}`,class:y([`icon-key-${e}`,{active:xe.value.includes(e)}]),onClick:k((l=>je("find",e)),["stop"])},[1!==e&&xe.value.includes(e)?(t(),m("span",{key:0,class:y([`icon-key-tips-${e}`]),onClick:k((l=>je("close-tips",e)),["stop"])},null,10,E)):f("",!0)],10,D))),64)),(t(),m(p,null,g(10,(e=>(t(),m(p,null,[e===we.value?(t(),m("span",{key:`icon-special-${e}`,class:y([`icon-special-${e}${_e.value}`]),onClick:k((l=>je("special",e)),["stop"])},null,10,O)):f("",!0)],64)))),64))])],2),r("div",W,[r("div",B,[(t(!0),m(p,null,g(Ie.value.gameCount+"",(e=>(t(),m("i",{class:y(`num-s-${e}`)},null,2)))),256))]),r("div",F,[(t(!0),m(p,null,g(Ie.value.scoreCount+"",(e=>(t(),m("i",{class:y(`num-s-${e}`)},null,2)))),256))])]),r("div",H,[(t(!0),m(p,null,g(Ke.value,(e=>(t(),m("i",{class:y(`num-${e}`)},null,2)))),256))])],2),"game"===ke.value?(t(),m("div",{key:0,id:"key-game",class:y(`skin-${_e.value}`)},[r("div",null,[r("div",{class:y(`bg-key-game${_e.value}`)},[r("div",J,[(t(),m(p,null,g(44,(e=>r("span",{class:y(["icon-k-1",{special:e===Ce.value},{active:e===Ce.value&&he.value}]),key:`icon-key-${e}`},[r("i",{onClick:l=>je("game-key",e)},null,8,M)],2))),64))]),r("span",{class:"dialogs-close",onClick:l[0]||(l[0]=e=>je("close-game",""))})],2)])],2)):f("",!0),$(r("div",P,[r("div",{class:"page-layer",style:w(`transform:scale(${-1!==fe.value.indexOf("eye-")?1:ge.value})`)},[C(x,{name:"fade"},{default:h((()=>[-1!==fe.value.indexOf("word-")?(t(),m("div",{key:0,class:"dialogs-word",onClick:l[1]||(l[1]=k((e=>je("word-close",fe.value)),["stop"]))},[["word-3","word-4"].includes(fe.value)?(t(),m("div",{key:0,class:y(`bg-${fe.value}${_e.value}`)},null,2)):(t(),m("div",{key:1,class:y(`bg-${fe.value}`)},null,2))])):f("",!0)])),_:1}),C(x,{name:"fade-fast"},{default:h((()=>["eye-1"===fe.value?(t(),m("div",Q,[r("div",{class:y(`bg-${fe.value}`)},null,2)])):f("",!0)])),_:1}),C(x,{name:"fade-fast"},{default:h((()=>["eye-2"===fe.value?(t(),m("div",Y,[r("div",{class:y(`bg-${fe.value}`)},null,2)])):f("",!0)])),_:1}),C(x,{name:"fade"},{default:h((()=>["rule"===fe.value?(t(),m("div",{key:0,class:"dialogs-rule",onClick:l[2]||(l[2]=k((e=>je("rule-close","")),["stop"]))},[r("div",A,[r("div",R,[_e.value?f("",!0):(t(),m("div",V)),r("div",{class:y(`bg-rule-3${_e.value}`)},null,2)])])])):f("",!0)])),_:1}),C(x,{name:"fade"},{default:h((()=>["success"===fe.value?(t(),m("div",{key:0,class:"dialogs-success",onClick:l[3]||(l[3]=k((e=>je("close-success","")),["stop"]))},[r("div",{class:y(`bg-success${_e.value}`)},null,2)])):f("",!0)])),_:1}),C(x,{name:"fade"},{default:h((()=>["fail"===fe.value?(t(),m("div",{key:0,class:"dialogs-fail",onClick:l[4]||(l[4]=k((e=>je("close-fail","")),["stop"]))},[r("div",{class:y(`bg-fail${_e.value}`)},null,2)])):f("",!0)])),_:1}),C(x,{name:"fade"},{default:h((()=>["empty"===fe.value?(t(),m("div",{key:0,class:"dialogs-empty",onClick:l[5]||(l[5]=k((e=>je("close-empty","")),["stop"]))},X)):f("",!0)])),_:1})],4)],512),[[b,fe.value]])],2),$(r("div",Z,[(t(!0),m(p,null,g(Se.audioList,(e=>(t(),m("audio",{id:"audio-item-"+e.name,key:"audio-item-"+e.name,src:e.src,loop:e.loop??!1},null,8,ee)))),128))],512),[[b,!1]])],64))}}),[["__scopeId","data-v-7359bb6a"]]);export{le as default};
