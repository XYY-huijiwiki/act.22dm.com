import{_ as e,d as s,a1 as a,o,c as l,m as n,q as i,T as t,y as d,z as r,j as c,t as u,n as m,l as p,F as g,s as h,a0 as v,u as f,a as k,g as y,e as w,f as b,p as x,a4 as C,k as L,x as T,S as I,K as B,M as $,N as _,C as j,G as D,O as S,P as U}from"./index-07d41525.js";import{w as z}from"./wxjssdk-9390c5f7.js";import{g as K}from"./sign-54d406fa.js";import{T as G,I as A}from"./index-4e2308b0.js";import"./isObjectLike-38825d63.js";const E=e=>{let s=e.floor,a=[[65,67],[72,139],[70,209],[71,280],[70,350],[71,421],[72,493],[70,563],[71,634],[78,712],[74,786],[76,862],[78,712],[74,786],[76,862],[78,712],[74,786],[76,862],[78,712],[74,786],[76,862],[78,712],[74,786],[76,862],[78,712],[74,786],[76,862],[78,712],[74,786],[76,862],[78,712],[74,786],[76,862],[78,712],[74,786],[76,862],[78,712],[74,786],[76,862],[78,712],[74,786],[76,862],[78,712],[74,786],[76,862],[78,712],[74,786],[76,862],[78,712],[74,786],[76,862],[78,712],[74,786],[76,862],[78,712],[74,786],[76,862],[78,712],[74,786],[76,862],[78,712],[74,786],[76,862],[78,712],[74,786],[76,862],[78,712],[74,786],[76,862],[78,712],[74,786],[76,862],[78,712],[74,786],[76,862],[78,712],[74,786],[76,862],[78,712],[74,786],[76,862],[78,712],[74,786],[76,862],[78,712],[74,786],[76,862],[78,712],[74,786],[76,862],[60,922],[59,981],[60,1041],[60,1101],[177,1278],[158,1436]];return{offsetY:0,height:a[s][0],by:a[s][1]}};let F,N;const M=s({name:"wolfsburg",components:{Textarea:G,Input:A},setup(e,s){var a,o;let l=new z({});v();const n=f(),i=k({userInfo:(null==(a=n.params)?void 0:a.userInfo)??{},loading:!1,volume:!1,scene:"mm",dialogs:"",form:{name:"",phone:"",address:""},scale:y(1600),k:"",rotate:!1,down:!1,gameover:!1,score:0,floor:0,hp:3,guide:0,timer:null,spriteConfig:null,houseList:[],rankList:[],maxFloor:96,dropdown:null,tips:"",beginTime:0,houseDown:0,perfect:0,danger:0,audioList:[{name:"bgm",src:"https://cpe-app-oss.oss-cn-shenzhen.aliyuncs.com/h5/wolfsburg/bgm.mp3",loop:!0},{name:"down",src:"https://cpe-app-oss.oss-cn-shenzhen.aliyuncs.com/h5/wolfsburg/down.mp3",loop:!1},{name:"fail",src:"https://cpe-app-oss.oss-cn-shenzhen.aliyuncs.com/h5/wolfsburg/fail.mp3",loop:!1},{name:"miss",src:"https://cpe-app-oss.oss-cn-shenzhen.aliyuncs.com/h5/wolfsburg/miss.mp3",loop:!1},{name:"success",src:"https://cpe-app-oss.oss-cn-shenzhen.aliyuncs.com/h5/wolfsburg/success.mp3",loop:!1}]});N=(null==(o=i.userInfo)?void 0:o.unionid)??"";const t=()=>{if("gp"==i.scene&&!i.guide&&i.down&&i.houseList.length){let e=i.houseList[i.houseList.length-1];if(e.down){let s=(e=>{var s;return(null==(s=document.getElementById("house-"+(e.length-1)))?void 0:s.getBoundingClientRect())??null})(i.houseList),a=(e=>{var s,a;return 1==e.length?null==(s=document.getElementById("house-bottom"))?void 0:s.getBoundingClientRect():null==(a=document.getElementById("house-"+(e.length-2)))?void 0:a.getBoundingClientRect()})(i.houseList),o=1==i.houseList.length?60:0,l=!1,n=0;if(s.top+s.height>=a.top+o-50){let t=((e,s)=>{let a=0;return e.top<s&&(a=100),a})(a,1300*i.scale);if(e.down=!1,(s.left<50||s.left>180)&&(i.hp--,r("miss"),i.houseList.splice(i.houseList.length-1,1),l=!0,c("miss")),i.houseList.length>1&&!l){let s=i.houseList[i.houseList.length-2];n=Math.abs(s.left-e.left),n>50?(i.hp--,r("miss"),i.houseList.splice(i.houseList.length-1,1),l=!0,c("miss")):n<10&&(r("perfect"),i.perfect++)}l||(i.floor++,i.score+=Math.ceil((100-n)/100*100),i.houseDown+=t,c("down")),e.top=a.top-s.height+o-i.houseDown+t,0==i.hp||i.floor==i.maxFloor?(i.gameover=!0,clearInterval(i.timer),setTimeout((()=>{d()}),0)):i.spriteConfig=E(i),10==i.floor?(r("danger"),i.danger=1):30==i.floor?(i.danger=2,r("danger")):60==i.floor&&(i.danger=3,r("danger")),setTimeout((()=>{i.down=!1}),200)}}}if("gp"==i.scene&&!i.guide&&!i.dropdown&&i.floor>10&&1e3*Math.random()>1e3-i.floor){let e=j(1,3),s=j(200,550);i.dropdown={type:e,left:s},setTimeout((()=>{i.dropdown=null}),3e3)}},d=()=>{i.dialogs=i.floor>=i.maxFloor?"success":"fail",c(i.dialogs);let{k:e,score:s,floor:a,perfect:o,hp:l}=i,n=K({k:e,unionid:N,score:s,level:a});D({ownerUnionid:N,activityKey:F,gameScore:s,levelNum:a,playTime:(new Date).getTime()-i.beginTime,extra:{perfect:o,hp:l},k:e,s:n})},r=e=>{i.tips="",setTimeout((()=>{i.tips=e}),0)},c=(e,s=!1)=>{_(i,e,s)};return w((()=>{var e,s;F=(null==(e=n.meta)?void 0:e.activityKey)??"wolfsburg";let a=location.origin+n.path,o=(null==(s=n.meta)?void 0:s.imgUrl)??"";b({activityKey:F}).then((({code:e,data:s})=>{0===e&&(i.k=s.k,I({activityKey:F,rankSize:10,endTime:"2023-10-31 00:00:00",periodNum:1}).then((({code:e,data:s})=>{0===e&&(i.rankList=s,s.some((e=>e.ownerUnionid==N))&&B({unionid:N,activityKey:F,periodNum:1}).then((({code:e,data:s})=>{s&&!s.name&&(i.dialogs="award")})))})))})),l.ready((()=>{var e,s;c("bgm",!0),l.updateShareData({title:(null==(e=n.meta)?void 0:e.title)??"",desc:(null==(s=n.meta)?void 0:s.desc)??"",link:a,imgUrl:o}),document.addEventListener("visibilitychange",(e=>{document.hidden?x():i.volume&&c("bgm",!0)}))}))})),{...C(i),onPlayAudio:c,onTouch:()=>{i.gameover||i.guide||i.down||(i.houseList.push((e=>{var s;let a=null==(s=document.getElementById("clip-sprite"))?void 0:s.getBoundingClientRect();return{...e.spriteConfig,top:a.top+a.height,left:a.left,down:!0}})(i)),setTimeout((()=>{i.down=!0})),i.beginTime||(i.beginTime=(new Date).getTime()))},onGameStart:()=>{i.houseList=[],i.score=0,i.floor=0,i.hp=3,i.down=!1,i.rotate=!0,i.gameover=!1,i.dropdown=null,i.guide=0,i.scene="gp",i.dialogs="",i.tips="",i.beginTime=0,i.houseDown=0,i.danger=0,i.perfect=0,i.spriteConfig=E(i),i.timer=setInterval((()=>{i.gameover||t()}),33)},onGameBack:()=>{i.dialogs="",i.scene="mm",i.timer&&clearInterval(i.timer)},submitAward:()=>{let{name:e,phone:s,address:a}=i.form;e&&s&&a?11==s.length?$({activityKey:F,ownerUnionid:N,address:a,name:e,phone:s,extra:{}}).then((()=>{i.dialogs="",alert("提交成功")})):alert("请填写11位手机号码"):alert("请输入正确的信息")}}}}),R=e=>(S("data-v-526489b9"),e=e(),U(),e),P={id:"page-wolfsburg"},O={key:0,id:"scene-mm",class:"scene-layer"},Y=R((()=>c("div",{class:"icon-mm"},null,-1))),q={class:"mm-btn"},H=R((()=>c("div",{class:"scene-bottom"},null,-1))),J={key:0,id:"scene-gp",class:"scene-layer"},Q={key:0,class:"icon-clip"},V=["id"],W=R((()=>c("div",{id:"house-bottom",class:"scene-bottom"},[c("div",{class:"icon-dog"})],-1))),X=R((()=>c("div",{class:"touch-area"},null,-1))),Z={class:"game-hp"},ee={class:"game-bar"},se={class:"game-score"},ae=R((()=>c("div",{class:"icon-score-1"},null,-1))),oe={class:"game-floor"},le=R((()=>c("div",{class:"icon-floor"},null,-1))),ne={id:"page-dialogs",class:"scene-layer"},ie=[R((()=>c("div",{class:"icon-book"},[c("div",{class:"rule-main"},[c("div",{class:"icon-rule-title"}),c("div",{class:"icon-rule-text"})])],-1)))],te={class:"icon-book"},de={class:"rank-main"},re=R((()=>c("div",{class:"icon-rank-title"},null,-1))),ce={class:"rank-list"},ue=R((()=>c("span",{class:"icon-rank-icon"},null,-1))),me={class:"rank-name"},pe={class:"rank-score"},ge=R((()=>c("i",{class:"num-small-score"},null,-1))),he={class:"rank-floor"},ve={class:"icon-success"},fe={class:"success-score"},ke=R((()=>c("i",{class:"icon-score-2"},null,-1))),ye=R((()=>c("i",{class:"icon-word-success"},null,-1))),we={key:0,class:"dialogs-fail"},be={class:"icon-fail"},xe={key:1,class:"dialogs-award"},Ce={class:"icon-award"},Le={id:"audio-list"},Te=["id","src","loop"];const Ie=e(M,[["render",function(e,s,v,f,k,y){const w=a("Input"),b=a("Textarea");return o(),l("div",P,[n(t,{name:"fade"},{default:i((()=>["mm"==e.scene?(o(),l("div",O,[c("div",{class:"mm-main",style:u(`transform:scale(${e.scale-.1})`)},[Y,c("div",q,[c("span",{class:"btn-start",onClick:s[0]||(s[0]=s=>e.onGameStart())}),c("span",{class:"btn-rule",onClick:s[1]||(s[1]=s=>e.dialogs="rule")}),c("span",{class:"btn-rank",onClick:s[2]||(s[2]=s=>e.dialogs="rank")})])],4),H])):p("",!0)])),_:1}),n(t,{name:"fade"},{default:i((()=>["gp"==e.scene?(o(),l("div",J,[c("div",{id:"game-clip",class:m(["scene-layer",[{rotate:e.rotate&&0==e.danger},"danger-"+e.danger]])},[e.spriteConfig?(o(),l("div",Q,[d(c("div",{id:"clip-sprite",style:u(`height:${e.spriteConfig.height}px;background-position:0px ${e.spriteConfig.by}px`)},null,4),[[r,!e.down&&!e.gameover&&e.floor!=e.maxFloor]])])):p("",!0)],2),c("div",{class:"house-list scene-layer",style:u(`transform:translateY(${e.houseDown}px)`)},[(o(!0),l(g,null,h(e.houseList,((e,s)=>(o(),l("span",{key:"house-"+s,id:"house-"+s,class:m([{down:e.down},"house-sprite"]),style:u(`top:${e.top}px;left:${e.left}px;height:${e.height}px;background-position:0px ${e.by}px`)},null,14,V)))),128)),W],4),X,e.tips?(o(),l("div",{key:0,class:m([["icon-"+e.tips],"game-tips"])},null,2)):p("",!0),e.dropdown?(o(),l("div",{key:1,class:m(["game-dropdown","icon-dropdown-"+e.dropdown.type]),style:u("left:"+e.dropdown.left+"px")},null,6)):p("",!0),c("div",{class:"touch-area",onClick:s[3]||(s[3]=L((s=>e.onTouch()),["stop"]))}),c("div",{class:m(["icon-back",{top:e.dialogs}]),onClick:s[4]||(s[4]=L((s=>e.onGameBack()),["stop"]))},null,2),c("div",Z,[(o(!0),l(g,null,h(e.hp,(e=>(o(),l("i",{class:"icon-hp",key:"hp-"+e})))),128))]),c("div",ee,[c("div",se,[ae,(o(!0),l(g,null,h(e.score+"",((e,s)=>(o(),l("i",{key:"score-1-text"+s,class:m("num-middle-"+e)},null,2)))),128))]),c("div",oe,[le,(o(!0),l(g,null,h(e.floor+"",((e,s)=>(o(),l("i",{key:"floor-text"+s,class:m("num-middle-"+e)},null,2)))),128))])])])):p("",!0)])),_:1}),d(c("div",ne,[c("div",{class:"scene-layer",style:u(`transform:scale(${e.scale})`)},[n(t,{name:"rule"},{default:i((()=>["rule"==e.dialogs?(o(),l("div",{key:0,class:"dialogs-rule",onClick:s[5]||(s[5]=s=>e.dialogs="")},ie)):p("",!0)])),_:1}),n(t,{name:"rule"},{default:i((()=>["rank"==e.dialogs?(o(),l("div",{key:0,class:"dialogs-rank",onClick:s[6]||(s[6]=s=>e.dialogs="")},[c("div",te,[c("div",de,[re,c("div",ce,[(o(!0),l(g,null,h(e.rankList,((e,s)=>{var a;return o(),l("div",{class:"rank-item",key:"rank-"+s},[ue,c("span",me,T((null==(a=e.userInfo)?void 0:a.nickname)??""),1),c("span",pe,[(o(!0),l(g,null,h(e.gameScore+"",((e,a)=>(o(),l("i",{key:"rank-score"+s+"-"+a,class:m("num-small-"+e)},null,2)))),128)),ge]),c("span",he,[(o(!0),l(g,null,h(e.levelNum+"",((e,a)=>(o(),l("i",{key:"rank-floor"+s+"-"+a,class:m("num-small-"+e)},null,2)))),128))])])})),128))])])])])):p("",!0)])),_:1}),n(t,{name:"role"},{default:i((()=>["success"==e.dialogs?(o(),l("div",{key:0,class:"dialogs-success",onClick:s[7]||(s[7]=s=>{e.scene="mm",e.dialogs=""})},[c("div",ve,[c("span",fe,[ke,(o(!0),l(g,null,h(e.score+"",((e,s)=>(o(),l("i",{key:"score-2-text"+s,class:m("num-big-"+e)},null,2)))),128)),ye])])])):p("",!0)])),_:1}),n(t,{name:"role"},{default:i((()=>["fail"==e.dialogs?(o(),l("div",we,[c("div",be,[c("span",{class:"fail-again",onClick:s[8]||(s[8]=L((s=>e.onGameStart()),["stop"]))})])])):p("",!0)])),_:1}),"guide"==e.dialogs?(o(),l("div",{key:0,class:"dialogs-guide",onClick:s[9]||(s[9]=s=>e.guide++)},[c("div",{class:m("icon-guide-"+e.guide)},null,2)])):p("",!0),"award"==e.dialogs?(o(),l("div",xe,[c("div",Ce,[n(w,{class:"award-name",value:e.form.name,"onUpdate:value":s[10]||(s[10]=s=>e.form.name=s)},null,8,["value"]),n(w,{class:"award-phone",value:e.form.phone,"onUpdate:value":s[11]||(s[11]=s=>e.form.phone=s)},null,8,["value"]),n(b,{class:"award-address",value:e.form.address,"onUpdate:value":s[12]||(s[12]=s=>e.form.address=s)},null,8,["value"]),c("span",{class:"award-submit",onClick:s[13]||(s[13]=s=>e.submitAward())})])])):p("",!0)],4)],512),[[r,e.dialogs]]),c("div",{class:m(["btn-music",{active:e.volume}]),onClick:s[14]||(s[14]=s=>e.onPlayAudio("bgm",!0))},null,2),d(c("div",Le,[(o(!0),l(g,null,h(e.audioList,(e=>(o(),l("audio",{id:"audio-item-"+e.name,key:"audio-item-"+e.name,src:e.src,loop:e.loop??!1},null,8,Te)))),128))],512),[[r,!1]])])}],["__scopeId","data-v-526489b9"]]);export{Ie as default};
