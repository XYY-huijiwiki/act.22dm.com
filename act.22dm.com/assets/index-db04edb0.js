import{_ as e,d as a,u as l,r as s,g as n,a as u,w as i,n as t,b as o,e as v,p as c,f as r,h as d,i as m,o as g,c as p,j as f,k as y,l as k,m as h,q as x,T as b,s as T,t as $,F as C,v as M,x as D,y as N,z as S,A as L,B as w,C as U,D as _,E as I,G as E,H as j}from"./index-8ef9f0fb.js";import{w as K}from"./wxjssdk-0eded10f.js";import{g as A}from"./sign-54d406fa.js";import{s as B,h as V}from"./loading-c179f433.js";import{t as X}from"./throttle-b72c38b4.js";import"./isObjectLike-38825d63.js";const Y=e=>(I("data-v-f18d48e4"),e=e(),E(),e),z={key:0,id:"mm",class:"scene-layer bg-mm"},R={class:"mm-top"},W={class:"mm-top-left"},F={class:"mm-top-right"},G=Y((()=>f("div",{class:"icon-mm-title"},null,-1))),H={key:0,id:"game",class:"scene-layer bg-game"},O={class:"target-score topbar-score"},q={class:"game-score topbar-score"},J={class:"topbar-timer"},P={key:0,class:"icon-50"},Q={key:0,class:"game-alert icon-alert-timer"},Z={key:1,class:"game-alert icon-alert-miss"},ee={class:"game-hole"},ae=Y((()=>f("div",{class:"icon-hole-0"},null,-1))),le=Y((()=>f("div",{class:"icon-hole-1"},null,-1))),se=["id"],ne=["onClick"],ue=["onClick"],ie={key:0,class:"icon-egg-out"},te={id:"page-dialogs"},oe={class:"gameover-content"},ve={class:"icon-gameover-score"},ce={class:"gameover-score-text"},re={key:0,class:"bg-gameover-success-2 scene-layer"},de={class:"level-need"},me={key:0,class:"dialogs-pause"},ge={key:0,class:"dialogs-rank bg-rank"},pe=Y((()=>f("span",{class:"icon-rank-title"},null,-1))),fe={class:"rank-list"},ye={class:"icon-rank-num"},ke={class:"rank-item-name"},he={class:"rank-item-score"},xe=Y((()=>f("i",{class:h("num-rf")},null,-1))),be=Y((()=>f("span",{class:"icon-rank-xi"},null,-1))),Te=Y((()=>f("span",{class:"icon-rank-hui"},null,-1))),$e={key:0,class:"dialogs-address bg-address"},Ce={class:"icon-address2"},Me={class:"address-form"},De={key:0,id:"audio-list"},Ne=["id","src","loop"],Se=e(a({__name:"index",setup(e){var a,I;let E,Y,Se,Le="https://cpe-oss-h5.oss-cn-shenzhen.aliyuncs.com/h5/20251002-v2/image";const{proxy:we}=j();let Ue=new K({});const _e=l();let Ie="",Ee=s({eggUpTime:250,eggStopTime:800,eggDownTime:250,eggTimeDecrease:20,eggTimeMin:300,smashDelay:80,eggScore:10,comboLimit:5,comboScore:10,cicfLevelTime:30,normalLevelTime:50,targetScoreCicf:200,targetScoreNormal:500,targetScoreNormalNextAdd:50,targetScoreNormalMax:3e3,cicfMaxLevel:1,eggNextTime:1e3,eggNextCount:2,eggNextTimeDecrease:100,eggNextTimeMin:300,eggNextCountMax:8,targetSuccessLevel:10,eggAddDelayMin:100,eggAddDelayMax:600,alertDuration:1500,eggScoreMonster:-50,monsterRatio:.2});const je=(null==(a=_e.params)?void 0:a.userInfo)??{},Ke=s(1),Ae=s(null==(I=_e.meta)?void 0:I.activityKey.includes("-cicf"));Se=Ae.value?"ofN_u6nBbWm3k8KmgyWetjEKIGaE":(null==je?void 0:je.unionid)??"";const Be=s(n(1600)),Ve=s("mm"),Xe=s(""),Ye=s(!1),ze=s([]),Re=s(!1),We=s(!1),Fe=s(!1),Ge=s(1),He=s(0),Oe=s([]),qe=s(0),Je=s([]),Pe=s(0),Qe=s(null),Ze=s(0),ea=s(0),aa=s(!1),la=s([]),sa=s(!1),na=s(!1),ua=s({phone:"",name:"",address:""});let ia=null,ta=null,oa=0,va=0,ca=0,ra=0,da=0;const ma=u({volume:!1,audioList:[{name:"bgm",src:`${Le}/audio/bgm.mp3`,loop:!0},{name:"dead",src:`${Le}/audio/dead.mp3`,loop:!1},{name:"monster",src:`${Le}/audio/monster.mp3`,loop:!1},{name:"timer",src:`${Le}/audio/timer.mp3`,loop:!1},{name:"fail",src:`${Le}/audio/fail.mp3`,loop:!1},{name:"out",src:`${Le}/audio/out.mp3`,loop:!1},{name:"success",src:`${Le}/audio/success.mp3`,loop:!1}]});i(Ze,((e,a)=>{Ae.value||(e>Ee.value.comboLimit&&(He.value+=Ee.value.comboScore),0===e&&a>Ee.value.comboLimit&&(Xe.value||Fe.value||(na.value=!0,setTimeout((()=>{na.value=!1}),Ee.value.alertDuration))))})),i(He,(e=>{e>=ea.value&&(Ae.value&&Ge.value>=Ee.value.cicfMaxLevel?Ta():ha())}));const ga=()=>{try{if(Fe.value||Xe.value)return;if(la.value.length<da&&!Fe.value){let e=[];for(let a=la.value.length;a<da;a++){let a=[];for(let l=1;l<=12;l++)[...la.value,...e].some((e=>e.index===l||4===Math.abs(e.index-l)))||a.push(l);if(!(a.length&&e.length+la.value.length<da))break;{let l=U(1,3),s=a[U(0,a.length-1)],n=Math.random()<Ee.value.monsterRatio,u=Ee.value.eggScore;n&&!Ae.value&&(l=4,u=Ee.value.eggScoreMonster),e.push({key:(new Date).getTime(),id:l,index:s,dead:0,score:u,status:0})}}e.length&&(e.forEach((e=>{la.value.some((a=>a.index===e.index))||la.value.push(e)})),la.value=la.value.filter(((e,a,l)=>l.findIndex((a=>a.index===e.index))===a)),t((()=>{let e=0;la.value.forEach((a=>{if(a&&!a.animationUpData){const l=document.getElementById(`hole-egg-${a.index}`);if(!l)return;const s=[{transform:"translateX(-50%) translateY(100%)"},{transform:"translateX(-50%) translateY(0%)"}],n={duration:oa,iterations:1,easing:"linear",fill:"forwards"};a.animationUpData=[s,n],e+=U(Ee.value.eggAddDelayMin,Ee.value.eggAddDelayMax),setTimeout((()=>{l.style.willChange="transform",l.style.backfaceVisibility="hidden",l.style.webkitBackfaceVisibility="hidden";const e=l.animate(s,n);a.animationUp=e,a.status=1,e.onfinish=()=>{a.dead||(a.status=2,ya(a))},Ye.value&&e.pause()}),e)}}))})))}}catch(e){}},pa=X(ga,50),fa=(e,a,l=0)=>{var s,n;try{if(null===a){const e=la.value.find((e=>e.index===l&&!e.dead&&3!==e.status));if(!e)return;a=e}if(a.dead)return;1===a.status&&(null==(n=null==(s=a.animationUp)?void 0:s.cancel)||n.call(s)),a.dead=4===a.id?4:Math.random()>.5?1:2,He.value+=a.score,a.score<0?(Ze.value=0,Na("monster"),aa.value=!0,setTimeout((()=>{aa.value=!1}),500)):(Ze.value++,Na("dead")),He.value=He.value<0?0:He.value,ya(a,!0),ka(e)}catch(u){}},ya=(e,a=!1)=>{try{setTimeout((()=>{if(a||!a&&!e.dead){if(!la.value.some((a=>a.index===e.index&&a.key===e.key)))return;if(!e.animationDown){const a=document.getElementById(`hole-egg-${e.index}`);if(!a)return;const l=a.animate([{transform:"translateX(-50%) translateY(100%)"}],{duration:ca,iterations:1,easing:"linear",fill:"forwards"});e.animationDown=l,e.status=3,l.onfinish=()=>{e.dead||4===e.id||(Ze.value=0);const a=la.value.indexOf(e);a>-1&&la.value.splice(a,1),setTimeout((()=>{pa()}),100)},Ye.value&&l.pause()}}}),a?0:va)}catch(l){}},ka=e=>{try{let{pageX:a,pageY:l}=e;const{left:s,top:n}=ia.getBoundingClientRect();Ae.value&&(a/=Ke.value,l/=Ke.value);let u=100*Be.value;Ae.value?Qe.value={left:a-s,top:l-n-2*u}:Qe.value={left:l-n-35*Be.value,top:750-a-2*u},setTimeout((()=>{Qe.value=null}),1*Ee.value.smashDelay)}catch(a){}},ha=(e=!1)=>{la.value=[],e?(Ge.value=1,Oe.value=[],Je.value=[],ea.value=Ae.value?Ee.value.targetScoreCicf:Ee.value.targetScoreNormal,oa=Ee.value.eggUpTime,va=Ee.value.eggStopTime,ca=Ee.value.eggDownTime,ra=Ee.value.eggNextTime,da=Ee.value.eggNextCount):(Je.value.push((Ae.value?Ee.value.cicfLevelTime:Ee.value.normalLevelTime)-qe.value),Oe.value.push(He.value),Ge.value++,ea.value+=Ee.value.targetScoreNormalNextAdd,Ze.value=0,oa-=Ee.value.eggTimeDecrease,va-=Ee.value.eggTimeDecrease,ca-=Ee.value.eggTimeDecrease,ra-=Ee.value.eggNextTimeDecrease,da+=.4,da=Math.floor(da),ea.value=ea.value>Ee.value.targetScoreNormalMax?Ee.value.targetScoreNormalMax:ea.value,oa=oa<Ee.value.eggTimeMin?Ee.value.eggTimeMin:oa,va=va<Ee.value.eggTimeMin?Ee.value.eggTimeMin:va,ca=ca<Ee.value.eggTimeMin?Ee.value.eggTimeMin:ca,ra=ra<Ee.value.eggNextTimeMin?Ee.value.eggNextTimeMin:ra,da=da>Ee.value.eggNextCountMax?Ee.value.eggNextCountMax:da),qe.value=Ae.value?Ee.value.cicfLevelTime:Ee.value.normalLevelTime,He.value=0,Ye.value=!1,Ve.value="game",Fe.value=!1,Ae.value?setTimeout((()=>{xa()}),1e3):Xe.value="level",t((()=>{ia=document.getElementById("game")}))},xa=()=>{Xe.value="",ba(),ga()},ba=()=>{ta&&clearInterval(ta),ta=null,qe.value=Ae.value?Ee.value.cicfLevelTime:Ee.value.normalLevelTime,ta=setInterval((()=>{Xe.value||(qe.value--,11===qe.value&&(Na("timer"),Xe.value||Fe.value||(sa.value=!0,setTimeout((()=>{sa.value=!1}),Ee.value.alertDuration)))),qe.value<=0&&(ta&&clearInterval(ta),ta=null,Ta())}),1e3)},Ta=()=>{try{ta&&clearInterval(ta),ta=null,Fe.value=!0,la.value=[],Je.value.push((Ae.value?Ee.value.cicfLevelTime:Ee.value.normalLevelTime)-qe.value),Oe.value.push(He.value),Pe.value=Oe.value.reduce(((e,a)=>e+a),0);const e=Je.value.reduce(((e,a)=>e+a),0);let a=Ge.value,l=Pe.value;const s={};Ae.value?Xe.value=l>=Ee.value.targetScoreCicf?"gameover-success":"gameover-fail":Xe.value=a>=Ee.value.targetSuccessLevel?"gameover-success":"gameover-fail";let n=A({k:Ie,unionid:Se,score:l,level:a});o({ownerUnionid:Se,activityKey:E,gameScore:l,levelNum:a,playTime:e,k:Ie,s:n,extra:s}).then((()=>{Ma()})),Na("gameover-success"===Xe.value?"success":"fail")}catch(e){}},$a=e=>{Xe.value=e,"pause"===e&&(Ye.value=!0,la.value.forEach((e=>{var a,l,s,n;1===e.status?null==(l=null==(a=e.animationUp)?void 0:a.pause)||l.call(a):3===e.status&&(null==(n=null==(s=e.animationDown)?void 0:s.pause)||n.call(s))})))},Ca=e=>{Xe.value="",Ye.value=!1,1===e?Ve.value="mm":2===e&&la.value.forEach((e=>{var a,l,s,n;1===e.status?null==(l=null==(a=e.animationUp)?void 0:a.play)||l.call(a):3===e.status&&(null==(n=null==(s=e.animationDown)?void 0:s.play)||n.call(s))}))},Ma=()=>{v({activityKey:E,periodNum:Y,unionid:Se,k:Ie,endTime:"2025-10-31 00:00:00",rankSize:10}).then((({code:e,data:a})=>{0===e&&(a.some((e=>e.ownerUnionid===Se)),ze.value=a)}))},Da=e=>{we.$Message.success(e)},Na=(e,a=!1)=>{c(ma,e,a)};return r((async()=>{var e,a;B("加载中...",Ae.value?0:90),E=(null==(e=_e.meta)?void 0:e.activityKey)??"20251002",Y=(null==(a=_e.meta)?void 0:a.periodNum)??1;const{innerWidth:l,innerHeight:s}=window;if(Ae.value&&l>1600){let e=l/1200,a=s/750;Ke.value=e<a?e:a}d({activityKey:E}).then((({code:e,data:a})=>{0===e&&(Ie=a.k,a.extra&&(Ee.value=a.extra),Ma())})).finally((()=>{V()})),Ae.value||Ue.ready((()=>{var e,a,l;Na("bgm",!0),Ue.updateShareData({title:(null==(e=_e.meta)?void 0:e.title)??"",desc:(null==(a=_e.meta)?void 0:a.desc)??"",link:location.origin+_e.path,imgUrl:(null==(l=_e.meta)?void 0:l.imgUrl)??""}),document.addEventListener("visibilitychange",(e=>{document.hidden?m():ma.volume&&Na("bgm",!0)}))}))})),(e,a)=>(g(),p(C,null,[f("div",{id:"page-20251002",class:h({m:!Ae.value,isCICF:Ae.value}),style:T(`scale:${Ke.value}`)},[y(b,{name:"fade"},{default:k((()=>["mm"==Ve.value?(g(),p("div",z,[f("div",R,[f("div",W,[f("span",{class:h(["btn-music",[{active:ma.volume}]]),onClick:a[0]||(a[0]=e=>Na("bgm",!0))},null,2)]),f("div",F,[f("span",{class:"btn-rule",onClick:a[1]||(a[1]=e=>$a("rule"))}),Ae.value?x("",!0):(g(),p("span",{key:0,class:"btn-rank",onClick:a[2]||(a[2]=e=>$a("rank"))}))])]),G,f("div",{class:"btn-start",onClick:a[3]||(a[3]=e=>ha(!0))})])):x("",!0)])),_:1}),y(b,{name:"fade"},{default:k((()=>["game"==Ve.value?(g(),p("div",H,[f("div",{id:"game-top-info",class:"bg-topbar",style:T(`scale:${$(n)(1100,Ae.value)}`)},[f("div",O,[(g(!0),p(C,null,M(ea.value+"",((e,a)=>(g(),p("span",{key:"topbar-target-score-"+a,class:h(`num-${e}-s`)},null,2)))),128))]),f("div",q,[(g(!0),p(C,null,M(He.value+"",((e,a)=>(g(),p("span",{key:"topbar-game-score-"+a,class:h(`num-${e}-s`)},null,2)))),128))]),f("div",J," 00 : "+D(qe.value>10?qe.value:"0"+qe.value),1),f("span",{class:"topbar-pause",onClick:a[4]||(a[4]=e=>$a("pause"))}),aa.value?(g(),p("span",P)):x("",!0)],4),sa.value?(g(),p("div",Q)):x("",!0),na.value?(g(),p("div",Z)):x("",!0),f("div",{id:"game-hole-list",style:T(`scale:${$(n)(1100,Ae.value)}`),onContextmenu:a[5]||(a[5]=N((()=>{}),["prevent"])),onSelectstart:a[6]||(a[6]=N((()=>{}),["prevent"])),onDragstart:a[7]||(a[7]=N((()=>{}),["prevent"])),class:h({"touch-disabled":Ae.value})},[(g(),p(C,null,M(12,(e=>f("div",{class:"game-hole-box",key:"hole-"+e},[f("div",ee,[ae,le,f("div",{class:h(["game-hole-role",{hasEgg:la.value.some((a=>a.index===e))}])},[(g(!0),p(C,null,M(la.value,(a=>(g(),p(C,{key:`egg-${a.index}-${a.key}`},[e===a.index?(g(),p("div",{key:0,class:h(["hole-egg",[`icon-egg-${a.id}`,{dead:a.dead},`icon-dead-${a.dead}`]]),id:"hole-egg-"+a.index},[e===a.index?(g(),p("div",{key:0,class:"hole-egg-click",onClick:e=>fa(e,a)},null,8,ne)):x("",!0)],10,se)):x("",!0)],64)))),128))],2),f("div",{class:"icon-hole-2",onClick:a=>fa(a,null,e)},null,8,ue),la.value.some((a=>a.index===e&&a.dead&&4!==a.id))?(g(),p("div",ie)):x("",!0)])]))),64))],38),Qe.value?(g(),p("div",{key:2,class:"icon-smash",style:T(`top:${Qe.value.top}px;left:${Qe.value.left}px;scale:${Be.value};`)},null,4)):x("",!0)])):x("",!0)])),_:1}),S(f("div",te,[y(b,{name:"fade"},{default:k((()=>["rule"===Xe.value?(g(),p("div",{key:0,class:"dialogs-rule",onClick:a[8]||(a[8]=N((e=>$a("")),["stop"]))},[f("div",{class:"bg-rule bg-100",style:T(`transform:scale(${Be.value})`)},null,4)])):x("",!0)])),_:1}),y(b,{name:"fade"},{default:k((()=>[["gameover-success","gameover-fail"].includes(Xe.value)?(g(),p("div",{key:0,class:h(["dialogs-gameover",`bg-${Xe.value}`])},[f("div",{class:"gameover-box",style:T(`scale:${$(n)("gameover-success"===Xe.value?1055:1500,Ae.value)}`)},[f("div",{class:h(`icon-${Xe.value}`)},[f("div",oe,[f("div",ve,[f("div",ce,[(g(!0),p(C,null,M(Pe.value+"",((e,a)=>(g(),p("span",{key:"gameover-score-"+a,class:h(`num-${e}-s`)},null,2)))),128))])])])],2)],4),"gameover-success"===Xe.value?(g(),p("div",re)):x("",!0),f("span",{class:"btn-back",onClick:a[9]||(a[9]=e=>Ca(1))})],2)):x("",!0)])),_:1}),y(b,{name:"fade"},{default:k((()=>["level"===Xe.value?(g(),p("div",{key:0,class:"dialogs-level",onClick:a[10]||(a[10]=e=>Ae.value||1!==Ge.value?xa():$a("tips"))},[f("div",{class:"bg-level bg-100",style:T(`transform:scale(${Be.value})`)},[f("div",de,[(g(!0),p(C,null,M(ea.value+"",((e,a)=>(g(),p("span",{key:"target-score-"+a,class:h(`num-${e}`)},null,2)))),128))])],4)])):x("",!0)])),_:1}),y(b,{name:"fade"},{default:k((()=>["tips"===Xe.value?(g(),p("div",{key:0,class:"dialogs-tips",onClick:a[11]||(a[11]=e=>xa())},[f("div",{class:"bg-tips bg-100",style:T(`transform:scale(${Be.value})`)},null,4)])):x("",!0)])),_:1}),y(b,{name:"fade"},{default:k((()=>["pause"===Xe.value?(g(),p("div",me,[f("div",{class:"bg-pause bg-100",style:T(`transform:scale(${Be.value})`)},[f("span",{class:"pause-reset",onClick:a[12]||(a[12]=e=>Ca(1))}),f("span",{class:"pause-continue",onClick:a[13]||(a[13]=e=>Ca(2))})],4)])):x("",!0)])),_:1}),y(b,{name:"fade"},{default:k((()=>["rank"===Xe.value?(g(),p("div",ge,[f("div",{class:"bg-rank-list",style:T(`transform:scale(${Be.value})`)},[pe,f("div",fe,[(g(!0),p(C,null,M(ze.value,((e,a)=>{var l;return g(),p("span",{class:"rank-item",key:"rank-item-"+a},[f("span",ye,[f("i",{class:h(`num-r${a+1}`)},null,2)]),f("span",ke,D((null==(l=e.userInfo)?void 0:l.nickname)??""),1),f("span",he,[(g(!0),p(C,null,M(e.gameScore+"",((e,l)=>(g(),p("i",{key:"rank-"+a+"-score-"+l,class:h(`num-${e}-ss`)},null,2)))),128)),xe])])})),128))]),be,Te],4),f("span",{class:"btn-back",onClick:a[14]||(a[14]=e=>$a(""))})])):x("",!0)])),_:1}),y(b,{name:"fade"},{default:k((()=>["address"===Xe.value?(g(),p("div",$e,[f("div",Ce,[f("div",Me,[S(f("input",{class:"address-name","onUpdate:modelValue":a[15]||(a[15]=e=>ua.value.name=e),autocomplete:"off",name:"name"},null,512),[[w,ua.value.name]]),S(f("input",{class:"address-phone","onUpdate:modelValue":a[16]||(a[16]=e=>ua.value.phone=e),autocomplete:"off",name:"phone"},null,512),[[w,ua.value.phone]]),S(f("input",{class:"address-address","onUpdate:modelValue":a[17]||(a[17]=e=>ua.value.address=e),autocomplete:"off",name:"address"},null,512),[[w,ua.value.address]])]),f("span",{class:"btn-back",onClick:a[18]||(a[18]=e=>$a(""))}),f("span",{class:"btn-submit",onClick:a[19]||(a[19]=e=>(()=>{let{phone:e,name:a,address:l}=ua.value,s={};if(a&&e&&l&&!Re.value)if(11==e.length){if(We.value)return;We.value=!0,B("提交中..."),_({activityKey:E,periodNum:Y,ownerUnionid:Se,address:l,name:a,phone:e,extra:s}).then((()=>{Da("提交成功"),Xe.value="",Re.value=!0})).finally((()=>{We.value=!1,V()}))}else Da("请填写11位手机号码");else Da("请输入正确的信息")})())})])])):x("",!0)])),_:1})],512),[[L,Xe.value]])],6),ma.audioList.length?S((g(),p("div",De,[(g(!0),p(C,null,M(ma.audioList,(e=>(g(),p("audio",{id:"audio-item-"+e.name,key:"audio-item-"+e.name,src:e.src,loop:e.loop??!1},null,8,Ne)))),128))],512)),[[L,!1]]):x("",!0)],64))}}),[["__scopeId","data-v-f18d48e4"]]);export{Se as default};
