import{_ as e,d as a,u as l,r as s,g as n,a as u,w as i,n as t,b as o,e as v,f as c,p as r,h as d,i as m,j as g,o as p,c as f,k as y,l as k,m as h,q as x,s as b,T,t as $,v as C,F as M,x as D,y as N,z as S,A as L,B as w,C as U,D as _,E as I,G as E,H as j,I as K}from"./index-9577e874.js";import{w as A}from"./wxjssdk-38d77626.js";import{g as B}from"./sign-54d406fa.js";import{s as V,h as X}from"./loading-3bc85e3d.js";import{t as Y}from"./throttle-b72c38b4.js";import"./isObjectLike-38825d63.js";const z=e=>(E("data-v-2e378332"),e=e(),j(),e),R={key:0,id:"mm",class:"scene-layer bg-mm"},W={class:"mm-top"},q={class:"mm-top-left"},F={class:"mm-top-right"},G=z((()=>y("div",{class:"icon-mm-title"},null,-1))),H={key:0,id:"game",class:"scene-layer bg-game"},O={class:"target-score topbar-score"},J={class:"game-score topbar-score"},P={class:"topbar-timer"},Q={key:0,class:"game-alert icon-alert-timer"},Z={key:1,class:"game-alert icon-alert-miss"},ee={class:"game-hole"},ae=z((()=>y("div",{class:"icon-hole-0"},null,-1))),le=z((()=>y("div",{class:"icon-hole-1"},null,-1))),se=["id"],ne=["onClick"],ue=["onClick"],ie={key:0,class:"icon-egg-out"},te={id:"page-dialogs"},oe={class:"gameover-content"},ve={class:"icon-gameover-score"},ce={class:"gameover-score-text"},re={class:"bg-level"},de={class:"level-need"},me=[z((()=>y("div",{class:"bg-tips"},null,-1)))],ge={key:0,class:"dialogs-pause"},pe={key:0,class:"dialogs-rank bg-rank"},fe=z((()=>y("span",{class:"icon-rank-title"},null,-1))),ye={class:"rank-list"},ke={class:"rank-item-num"},he={class:"rank-item-name"},xe={class:"rank-item-score"},be=z((()=>y("i",{class:x("num-rf")},null,-1))),Te={key:0,class:"dialogs-address bg-address"},$e={class:"icon-address2"},Ce={class:"address-form"},Me={key:0,id:"audio-list"},De=["id","src","loop"],Ne=e(a({__name:"index",setup(e){var a,E;let j,z,Ne,Se="https://cpe-oss-h5.oss-cn-shenzhen.aliyuncs.com/h5/20251002/image-v1";const{proxy:Le}=K();let we=new A({});const Ue=l();let _e="",Ie=s({eggUpTime:250,eggStopTime:800,eggDownTime:250,eggTimeDecrease:20,eggTimeMin:300,smashDelay:80,eggScore:10,comboLimit:5,comboScore:10,cicfLevelTime:30,normalLevelTime:50,targetScoreCicf:200,targetScoreNormal:500,targetScoreNormalNextAdd:50,targetScoreNormalMax:3e3,cicfMaxLevel:1,eggNextTime:1e3,eggNextCount:2,eggNextTimeDecrease:100,eggNextTimeMin:300,eggNextCountMax:8,targetSuccessLevel:10,eggAddDelayMin:100,eggAddDelayMax:600,alertDuration:1500,eggScoreMonster:-50,monsterRatio:.2});const Ee=(null==(a=Ue.params)?void 0:a.userInfo)??{},je=s(1),Ke=s(null==(E=Ue.meta)?void 0:E.activityKey.includes("-cicf"));Ne=Ke.value?"ofN_u6nBbWm3k8KmgyWetjEKIGaE":(null==Ee?void 0:Ee.unionid)??"";const Ae=s(n(Ke.value?1300:1400,Ke.value)),Be=s("mm"),Ve=s(""),Xe=s(!1),Ye=s([]),ze=s(!1),Re=s(!1),We=s(!1),qe=s(1),Fe=s(0),Ge=s([]),He=s(0),Oe=s([]),Je=s(0),Pe=s(null),Qe=s(0),Ze=s(0),ea=s([]),aa=s(!1),la=s(!1),sa=s({phone:"",name:"",address:""});let na=null,ua=null,ia=0,ta=0,oa=0,va=0,ca=0;const ra=u({volume:!1,audioList:[{name:"bgm",src:`${Se}/audio/bgm.mp3`,loop:!0},{name:"dead",src:`${Se}/audio/dead.mp3`,loop:!1},{name:"monster",src:`${Se}/audio/monster.mp3`,loop:!1},{name:"timer",src:`${Se}/audio/timer.mp3`,loop:!1},{name:"fail",src:`${Se}/audio/fail.mp3`,loop:!1},{name:"out",src:`${Se}/audio/out.mp3`,loop:!1},{name:"success",src:`${Se}/audio/success.mp3`,loop:!1}]});i(Qe,((e,a)=>{Ke.value||(e>Ie.value.comboLimit&&(Fe.value+=Ie.value.comboScore),0===e&&a>Ie.value.comboLimit&&(Ve.value||We.value||(la.value=!0,setTimeout((()=>{la.value=!1}),Ie.value.alertDuration))))})),i(Fe,(e=>{e>=Ze.value&&(Ke.value&&qe.value>=Ie.value.cicfMaxLevel?xa():ya())}));const da=()=>{try{if(We.value||Ve.value)return;if(ea.value.length<ca&&!We.value){let e=[];for(let a=ea.value.length;a<ca;a++){let a=[];for(let l=1;l<=12;l++)[...ea.value,...e].some((e=>e.index===l||4===Math.abs(e.index-l)))||a.push(l);if(!(a.length&&e.length+ea.value.length<ca))break;{let l=_(1,3),s=a[_(0,a.length-1)],n=Math.random()<Ie.value.monsterRatio,u=Ie.value.eggScore;n&&!Ke.value&&(l=4,u=Ie.value.eggScoreMonster),e.push({key:(new Date).getTime(),id:l,index:s,dead:0,score:u,status:0})}}e.length&&(e.forEach((e=>{ea.value.some((a=>a.index===e.index))||ea.value.push(e)})),ea.value=ea.value.filter(((e,a,l)=>l.findIndex((a=>a.index===e.index))===a)),t((()=>{let e=0;ea.value.forEach((a=>{if(a&&!a.animationUpData){const l=document.getElementById(`hole-egg-${a.index}`);if(!l)return;const s=[{transform:"translateX(-50%) translateY(100%)"},{transform:"translateX(-50%) translateY(0%)"}],n={duration:ia,iterations:1,easing:"linear",fill:"forwards"};a.animationUpData=[s,n],e+=_(Ie.value.eggAddDelayMin,Ie.value.eggAddDelayMax),setTimeout((()=>{l.style.willChange="transform",l.style.backfaceVisibility="hidden",l.style.webkitBackfaceVisibility="hidden";const e=l.animate(s,n);a.animationUp=e,a.status=1,e.onfinish=()=>{a.dead||(a.status=2,pa(a))},Xe.value&&e.pause()}),e)}}))})))}}catch(e){}},ma=Y(da,50),ga=(e,a,l=0)=>{var s,n;try{if(null===a){const e=ea.value.find((e=>e.index===l&&!e.dead&&3!==e.status));if(!e)return;a=e}if(a.dead)return;1===a.status&&(null==(n=null==(s=a.animationUp)?void 0:s.cancel)||n.call(s)),a.dead=4===a.id?4:Math.random()>.5?1:2,Fe.value+=a.score,a.score<0?(Qe.value=0,Ma("monster")):(Qe.value++,Ma("dead")),Fe.value=Fe.value<0?0:Fe.value,pa(a,!0),fa(e)}catch(u){}},pa=(e,a=!1)=>{try{setTimeout((()=>{if(a||!a&&!e.dead){if(!ea.value.some((a=>a.index===e.index&&a.key===e.key)))return;if(!e.animationDown){const a=document.getElementById(`hole-egg-${e.index}`);if(!a)return;const l=a.animate([{transform:"translateX(-50%) translateY(100%)"}],{duration:oa,iterations:1,easing:"linear",fill:"forwards"});e.animationDown=l,e.status=3,l.onfinish=()=>{e.dead||4===e.id||(Qe.value=0);const a=ea.value.indexOf(e);a>-1&&ea.value.splice(a,1),setTimeout((()=>{ma()}),100)},Xe.value&&l.pause()}}}),a?0:ta)}catch(l){}},fa=e=>{try{let{pageX:a,pageY:l}=e;const{left:s,top:n}=na.getBoundingClientRect();Ke.value&&(a/=je.value,l/=je.value);let u=50*Ae.value;Ke.value?Pe.value={left:a-s,top:l-n-2*u}:Pe.value={left:l-n,top:750-a-2*u},setTimeout((()=>{Pe.value=null}),Ie.value.smashDelay)}catch(a){}},ya=(e=!1)=>{ea.value=[],e?(qe.value=1,Ge.value=[],Oe.value=[],Ze.value=Ke.value?Ie.value.targetScoreCicf:Ie.value.targetScoreNormal,ia=Ie.value.eggUpTime,ta=Ie.value.eggStopTime,oa=Ie.value.eggDownTime,va=Ie.value.eggNextTime,ca=Ie.value.eggNextCount):(Oe.value.push((Ke.value?Ie.value.cicfLevelTime:Ie.value.normalLevelTime)-He.value),Ge.value.push(Fe.value),qe.value++,Ze.value+=Ie.value.targetScoreNormalNextAdd,Qe.value=0,ia-=Ie.value.eggTimeDecrease,ta-=Ie.value.eggTimeDecrease,oa-=Ie.value.eggTimeDecrease,va-=Ie.value.eggNextTimeDecrease,ca+=.4,ca=Math.floor(ca),Ze.value=Ze.value>Ie.value.targetScoreNormalMax?Ie.value.targetScoreNormalMax:Ze.value,ia=ia<Ie.value.eggTimeMin?Ie.value.eggTimeMin:ia,ta=ta<Ie.value.eggTimeMin?Ie.value.eggTimeMin:ta,oa=oa<Ie.value.eggTimeMin?Ie.value.eggTimeMin:oa,va=va<Ie.value.eggNextTimeMin?Ie.value.eggNextTimeMin:va,ca=ca>Ie.value.eggNextCountMax?Ie.value.eggNextCountMax:ca),He.value=Ke.value?Ie.value.cicfLevelTime:Ie.value.normalLevelTime,Fe.value=0,Xe.value=!1,Be.value="game",We.value=!1,Ke.value?setTimeout((()=>{ka()}),1e3):Ve.value="level",t((()=>{na=document.getElementById("game")}))},ka=()=>{Ve.value="",ha(),da()},ha=()=>{ua&&clearInterval(ua),ua=null,He.value=Ke.value?Ie.value.cicfLevelTime:Ie.value.normalLevelTime,ua=setInterval((()=>{Ve.value||(He.value--,11===He.value&&(Ma("timer"),Ve.value||We.value||(aa.value=!0,setTimeout((()=>{aa.value=!1}),Ie.value.alertDuration)))),He.value<=0&&(ua&&clearInterval(ua),ua=null,xa())}),1e3)},xa=()=>{try{ua&&clearInterval(ua),ua=null,We.value=!0,ea.value=[],Oe.value.push((Ke.value?Ie.value.cicfLevelTime:Ie.value.normalLevelTime)-He.value),Ge.value.push(Fe.value),Je.value=Ge.value.reduce(((e,a)=>e+a),0);const e=Oe.value.reduce(((e,a)=>e+a),0);let a=qe.value,l=Je.value;const s={};Ke.value?Ve.value=l>=Ie.value.targetScoreCicf?"gameover-success":"gameover-fail":Ve.value=a>=Ie.value.targetSuccessLevel?"gameover-success":"gameover-fail";let n=B({k:_e,unionid:Ne,score:l,level:a});o({ownerUnionid:Ne,activityKey:j,gameScore:l,levelNum:a,playTime:e,k:_e,s:n,extra:s}).then((()=>{$a()})),Ma("gameover-success"===Ve.value?"success":"fail")}catch(e){}},ba=e=>{Ve.value=e,"pause"===e&&(Xe.value=!0,ea.value.forEach((e=>{var a,l,s,n;1===e.status?null==(l=null==(a=e.animationUp)?void 0:a.pause)||l.call(a):3===e.status&&(null==(n=null==(s=e.animationDown)?void 0:s.pause)||n.call(s))})))},Ta=e=>{Ve.value="",Xe.value=!1,1===e?Be.value="mm":2===e&&ea.value.forEach((e=>{var a,l,s,n;1===e.status?null==(l=null==(a=e.animationUp)?void 0:a.play)||l.call(a):3===e.status&&(null==(n=null==(s=e.animationDown)?void 0:s.play)||n.call(s))}))},$a=()=>{v({activityKey:j,periodNum:z,unionid:Ne,k:_e,endTime:"2025-10-31 00:00:00",rankSize:10}).then((({code:e,data:a})=>{0===e&&(a.some((e=>e.ownerUnionid===Ne))&&c({unionid:Ne,activityKey:j,periodNum:z}).then((({code:e,data:a})=>{0===e&&((null==a?void 0:a.name)?ze.value=!0:Ve.value="address")})),Ye.value=a)}))},Ca=e=>{Le.$Message.success(e)},Ma=(e,a=!1)=>{r(ra,e,a)};return d((async()=>{var e,a;V("加载中...",Ke.value?0:90),j=(null==(e=Ue.meta)?void 0:e.activityKey)??"20251002",z=(null==(a=Ue.meta)?void 0:a.periodNum)??1;const{innerWidth:l,innerHeight:s}=window;if(Ke.value&&l>1600){let e=l/1200,a=s/750;je.value=e<a?e:a}m({activityKey:j}).then((({code:e,data:a})=>{0===e&&(_e=a.k,a.extra&&(Ie.value=a.extra),$a())})).finally((()=>{X()})),Ke.value||we.ready((()=>{var e,a,l;Ma("bgm",!0),we.updateShareData({title:(null==(e=Ue.meta)?void 0:e.title)??"",desc:(null==(a=Ue.meta)?void 0:a.desc)??"",link:location.origin+Ue.path,imgUrl:(null==(l=Ue.meta)?void 0:l.imgUrl)??""}),document.addEventListener("visibilitychange",(e=>{document.hidden?g():ra.volume&&Ma("bgm",!0)}))}))})),(e,a)=>(p(),f(M,null,[y("div",{id:"page-20251002",class:x({m:!Ke.value,isCICF:Ke.value}),style:$(`scale:${je.value}`)},[k(T,{name:"fade"},{default:h((()=>["mm"==Be.value?(p(),f("div",R,[y("div",W,[y("div",q,[y("span",{class:x(["btn-music",[{active:ra.volume}]]),onClick:a[0]||(a[0]=e=>Ma("bgm",!0))},null,2)]),y("div",F,[y("span",{class:"btn-rule",onClick:a[1]||(a[1]=e=>ba("rule"))}),Ke.value?b("",!0):(p(),f("span",{key:0,class:"btn-rank",onClick:a[2]||(a[2]=e=>ba("rank"))}))])]),G,y("div",{class:"btn-start",onClick:a[3]||(a[3]=e=>ya(!0))})])):b("",!0)])),_:1}),k(T,{name:"fade"},{default:h((()=>["game"==Be.value?(p(),f("div",H,[y("span",{class:"icon-game-left",style:$(`scale:${C(n)(1600,Ke.value)}`),onClick:a[4]||(a[4]=e=>ba("pause"))},null,4),y("span",{class:"icon-game-right",style:$(`scale:${C(n)(1400,Ke.value)}`)},null,4),y("div",{id:"game-top-info",class:"bg-topbar",style:$(`scale:${C(n)(1100,Ke.value)}`)},[y("div",O,[(p(!0),f(M,null,D(Ze.value+"",((e,a)=>(p(),f("span",{key:"topbar-target-score-"+a,class:x(`num-${e}-s`)},null,2)))),128))]),y("div",J,[(p(!0),f(M,null,D(Fe.value+"",((e,a)=>(p(),f("span",{key:"topbar-game-score-"+a,class:x(`num-${e}-s`)},null,2)))),128))]),y("div",P,[(p(!0),f(M,null,D(He.value+"",((e,a)=>(p(),f("span",{key:"topbar-game-time-"+a,class:x(`num-${e}-s`)},null,2)))),128))])],4),y("span",{class:"btn-pause",onClick:a[5]||(a[5]=e=>ba("pause"))}),aa.value?(p(),f("div",Q)):b("",!0),la.value?(p(),f("div",Z)):b("",!0),y("div",{id:"game-hole-list",style:$(`scale:${C(n)(1100,Ke.value)}`),onContextmenu:a[6]||(a[6]=N((()=>{}),["prevent"])),onSelectstart:a[7]||(a[7]=N((()=>{}),["prevent"])),onDragstart:a[8]||(a[8]=N((()=>{}),["prevent"])),class:x({"touch-disabled":Ke.value})},[(p(),f(M,null,D(12,(e=>y("div",{class:"game-hole-box",key:"hole-"+e},[y("div",ee,[ae,le,y("div",{class:x(["game-hole-role",{hasEgg:ea.value.some((a=>a.index===e))}])},[(p(!0),f(M,null,D(ea.value,(a=>(p(),f(M,{key:`egg-${a.index}-${a.key}`},[e===a.index?(p(),f("div",{key:0,class:x(["hole-egg",[`icon-egg-${a.id}`,{dead:a.dead},`icon-dead-${a.dead}`]]),id:"hole-egg-"+a.index},[e===a.index?(p(),f("div",{key:0,class:"hole-egg-click",onClick:e=>ga(e,a)},null,8,ne)):b("",!0)],10,se)):b("",!0)],64)))),128))],2),y("div",{class:"icon-hole-2",onClick:a=>ga(a,null,e)},null,8,ue),ea.value.some((a=>a.index===e&&a.dead&&4!==a.id))?(p(),f("div",ie)):b("",!0)])]))),64))],38),Pe.value?(p(),f("div",{key:2,class:"icon-smash",style:$(`top:${Pe.value.top}px;left:${Pe.value.left}px;scale:${Ae.value};`)},null,4)):b("",!0)])):b("",!0)])),_:1}),S(y("div",te,[k(T,{name:"fade"},{default:h((()=>["rule"===Ve.value?(p(),f("div",{key:0,class:"dialogs-rule",onClick:a[9]||(a[9]=N((e=>ba("")),["stop"]))},[y("div",{class:"bg-rule",style:$(`transform:scale(${Ae.value})`)},null,4)])):b("",!0)])),_:1}),k(T,{name:"fade"},{default:h((()=>[["gameover-success","gameover-fail"].includes(Ve.value)?(p(),f("div",{key:0,class:x(["dialogs-gameover",`bg-${Ve.value}`])},[y("div",{class:x(["gameover-box",`icon-${Ve.value}`]),style:$(`transform:scale(${Ae.value})`)},[y("div",oe,[y("span",{class:"btn-back",onClick:a[10]||(a[10]=e=>Ta(1))}),y("div",ve,[y("div",ce,[(p(!0),f(M,null,D(Je.value+"",((e,a)=>(p(),f("span",{key:"gameover-score-"+a,class:x(`num-${e}-s`)},null,2)))),128))])])])],6)],2)):b("",!0)])),_:1}),k(T,{name:"fade"},{default:h((()=>["level"===Ve.value?(p(),f("div",{key:0,class:"dialogs-level",onClick:a[11]||(a[11]=e=>Ke.value||1!==qe.value?ka():ba("tips"))},[y("div",re,[y("div",de,[(p(!0),f(M,null,D(Ze.value+"",((e,a)=>(p(),f("span",{key:"target-score-"+a,class:x(`num-${e}`)},null,2)))),128))])])])):b("",!0)])),_:1}),k(T,{name:"fade"},{default:h((()=>["tips"===Ve.value?(p(),f("div",{key:0,class:"dialogs-tips",onClick:a[12]||(a[12]=e=>ka())},me)):b("",!0)])),_:1}),k(T,{name:"fade"},{default:h((()=>["pause"===Ve.value?(p(),f("div",ge,[y("div",{class:"bg-pause",style:$(`transform:scale(${Ae.value})`)},[y("span",{class:"pause-reset",onClick:a[13]||(a[13]=e=>Ta(1))}),y("span",{class:"pause-continue",onClick:a[14]||(a[14]=e=>Ta(2))})],4)])):b("",!0)])),_:1}),k(T,{name:"fade"},{default:h((()=>["rank"===Ve.value?(p(),f("div",pe,[y("div",{class:"bg-rank-list",style:$(`transform:scale(${Ae.value})`)},[fe,y("div",ye,[(p(!0),f(M,null,D(Ye.value,((e,a)=>{var l;return p(),f("span",{class:"rank-item icon-rank-item",key:"rank-item-"+a},[y("span",ke,[y("i",{class:x(`num-r${a+1}`)},null,2)]),y("span",he,w((null==(l=e.userInfo)?void 0:l.nickname)??""),1),y("span",xe,[(p(!0),f(M,null,D(e.gameScore+"",((e,l)=>(p(),f("i",{key:"rank-"+a+"-score-"+l,class:x(`num-${e}-ss`)},null,2)))),128)),be])])})),128))]),y("span",{class:"btn-back",onClick:a[15]||(a[15]=e=>ba(""))})],4)])):b("",!0)])),_:1}),k(T,{name:"fade"},{default:h((()=>["address"===Ve.value?(p(),f("div",Te,[y("div",$e,[y("div",Ce,[S(y("input",{class:"address-name","onUpdate:modelValue":a[16]||(a[16]=e=>sa.value.name=e),autocomplete:"off",name:"name"},null,512),[[U,sa.value.name]]),S(y("input",{class:"address-phone","onUpdate:modelValue":a[17]||(a[17]=e=>sa.value.phone=e),autocomplete:"off",name:"phone"},null,512),[[U,sa.value.phone]]),S(y("input",{class:"address-address","onUpdate:modelValue":a[18]||(a[18]=e=>sa.value.address=e),autocomplete:"off",name:"address"},null,512),[[U,sa.value.address]])]),y("span",{class:"btn-back",onClick:a[19]||(a[19]=e=>ba(""))}),y("span",{class:"btn-submit",onClick:a[20]||(a[20]=e=>(()=>{let{phone:e,name:a,address:l}=sa.value,s={};if(a&&e&&l&&!ze.value)if(11==e.length){if(Re.value)return;Re.value=!0,V("提交中..."),I({activityKey:j,periodNum:z,ownerUnionid:Ne,address:l,name:a,phone:e,extra:s}).then((()=>{Ca("提交成功"),Ve.value="",ze.value=!0})).finally((()=>{Re.value=!1,X()}))}else Ca("请填写11位手机号码");else Ca("请输入正确的信息")})())})])])):b("",!0)])),_:1})],512),[[L,Ve.value]])],6),ra.audioList.length?S((p(),f("div",Me,[(p(!0),f(M,null,D(ra.audioList,(e=>(p(),f("audio",{id:"audio-item-"+e.name,key:"audio-item-"+e.name,src:e.src,loop:e.loop??!1},null,8,De)))),128))],512)),[[L,!1]]):b("",!0)],64))}}),[["__scopeId","data-v-2e378332"]]);export{Ne as default};
