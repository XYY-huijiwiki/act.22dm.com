import{_ as e,d as l,u as a,Y as s,r as i,g as u,a as o,L as c,h as n,i as v,j as d,o as t,c as m,k as r,q as y,F as p,x as g,y as k,s as f,z as $,A as b,t as w,l as h,m as C,T as x,D as T,b as _,O as I,p as S,I as K,G as L,H as j}from"./index-9577e874.js";import{w as N}from"./wxjssdk-38d77626.js";import{g as G}from"./sign-54d406fa.js";import{g as U,a as q}from"./utils-5c8c25a0.js";const z={class:"game-key page-layer"},D=["onClick"],E=["onClick"],O=["onClick"],W={class:"game-top-info"},H={class:"icon-topbar-game"},A={class:"icon-topbar-prize"},B={class:"game-timer"},F={class:"key-box"},M=["onClick"],Y={id:"page-dialogs"},J={key:0,class:"dialogs-eye"},P={key:0,class:"dialogs-eye"},Q={class:"bg-rule-1"},R={class:"bg-rule-scroll"},V={key:0,class:"bg-rule-2"},X=[(e=>(L("data-v-7359bb6a"),e=e(),j(),e))((()=>r("div",{class:"bg-empty"},null,-1)))],Z={id:"audio-list"},ee=["id","src","loop"],le=e(l({__name:"index",setup(e){var l,L;let j,le,ae,se,ie="",ue="",oe=new N({}),ce=null,ne="https://cpe-app-oss.oss-cn-shenzhen.aliyuncs.com/h5/0109-key/image-vvv";const{proxy:ve}=K(),de=a(),te=s(),me=(null==(l=de.params)?void 0:l.userInfo)??{};ae=(null==me?void 0:me.unionid)??"";const re=i({timeLimit:40,delaySuccessTime:500,successGetScore:50,failGetScore:25,eyeTime:500,eyeTime2:800,whiteList:["ofN_u6nBbWm3k8KmgyWetjEKIGaE"]}),ye=i(window.innerHeight>1.5*window.innerWidth),pe=i(!1),ge=i(u(1200)),ke=i(""),fe=i("rule"),$e=i([]),be=i(40),we=i(0),he=i(10),Ce=i(!1),xe=i([]),Te=i([]),_e=i((null==(L=null==de?void 0:de.query)?void 0:L.skinId)??""),Ie=o({imgUrl:ne,volume:!1,audioList:[{name:"bgm",src:`${ne}/audio/bgm.mp3`,loop:!0},{name:"find",src:`${ne}/audio/find.mp3`,loop:!1},{name:"foot",src:`${ne}/audio/foot.mp3`,loop:!1},{name:"key",src:`${ne}/audio/key.mp3`,loop:!1},{name:"success",src:`${ne}/audio/success.mp3`,loop:!1},{name:"timer",src:`${ne}/audio/timer.mp3`,loop:!1},{name:"word-1",src:`${ne}/audio/word-1.mp3`,loop:!1}]}),Se=c((()=>{const e=U($e.value);return{gameCount:q($e.value),scoreCount:e}})),Ke=c((()=>{const e=be.value;let l=180===e?3:e>=120?2:e>=60?1:0,a=(e-60*l+"").split("");return`${l}d${1===a.length?"0":a[0]}${1===a.length?a[0]:a[1]}`.split("")})),Le=()=>{we.value=T(1,10),ce&&clearInterval(ce),be.value=re.value.timeLimit,xe.value=[],Te.value=[],Ce.value=!1,he.value=0,ke.value="",fe.value="2"===_e.value?"word-3":"word-1"},je=(e,l="")=>{if("rule-close"===e)Le();else if("word-close"===e){let e=fe.value.split("word-")[1];e*=1,e<=3?3===e?(fe.value="",ce=setInterval((()=>{fe.value||be.value--,0===be.value?(ce&&clearInterval(ce),Ge("fail")):10===be.value&&qe("timer")}),1e3),Ue({type:"game-play",activityKey:j})):fe.value="word-"+(1*e+1):4===e&&Ne()}else if("special"===e)qe("key"),fe.value="word-4";else if("find"===e){if(Te.value.includes(l)||(Te.value.push(l),qe("find")),xe.value.includes(l)){const e=xe.value.findIndex((e=>e===l));-1!==e&&xe.value.splice(e,1)}else xe.value=[l];4===l&&qe("foot")}else if("close-tips"===e){if(l&&1!==l&&xe.value.includes(l)){const e=xe.value.findIndex((e=>e===l));-1!==e&&xe.value.splice(e,1)}}else"game-key"===e?l!==he.value||Ce.value||(Ce.value=!0,ce&&clearInterval(ce),setTimeout((()=>{Ge("success")}),re.value.delaySuccessTime)):"close-eye"===e?"eye-1"===l?(fe.value="eye-2",setTimeout((()=>{je("close-eye",fe.value)}),re.value.eyeTime2)):"eye-2"===l&&(fe.value="fail"):"close-success"===e||"close-fail"===e?Se.value.gameCount>0?Le():fe.value="empty":"close-empty"===e?te.go(-1):"close-game"===e&&(ke.value="")},Ne=()=>{fe.value="",ke.value="game",xe.value=[],Ce.value=!1,he.value=T(1,44)},Ge=e=>{fe.value="success"===e?"success":"eye-1";const l="success"===e?1:0,a=re.value.timeLimit-be.value,s="success"===e?re.value.successGetScore:re.value.failGetScore;"success"===e?qe("success"):(qe("word-1"),setTimeout((()=>{je("close-eye",fe.value)}),re.value.eyeTime)),Ue({type:"game-play-0109-key",getScore:s,gameScore:l,playTime:a}),_({ownerUnionid:ae,activityKey:j,gameScore:l,levelNum:0,playTime:a,k:ie,s:G({k:ie,unionid:ae,score:l,level:0})})},Ue=(e={})=>{let l=G({k:ue,unionid:ae,score:0,level:0});const a=(new Date).getTime();$e.value.push({addTime:a,extra:{...e}}),_({ownerUnionid:ae,activityKey:se,gameScore:0,levelNum:0,playTime:a,extra:e,k:ue,s:l})},qe=(e,l=!1)=>{S(Ie,e,l)};return n((()=>{var e,l,a;j=(null==(e=de.meta)?void 0:e.activityKey)??"0109-key",se=(null==(l=de.meta)?void 0:l.activityKey0109)??"0109",le=(null==(a=de.meta)?void 0:a.periodNum)??1,pe.value=!0,v({activityKey:j,periodNum:le}).then((({code:e,data:l})=>{var a;0===e?(ie=l.k,l.extra&&(re.value=l.extra),I({activityKey:se,periodNum:le,ownerUnionid:ae}).then((({code:e,data:l})=>{0===e&&($e.value=l)}))):(a="活动初始化异常,请刷新后再试",ve.$Message.success(a))})).finally((()=>{pe.value=!1})),v({activityKey:se,periodNum:le}).then((({code:e,data:l})=>{0===e&&(ue=l.k)})),oe.ready((()=>{var e,l,a;qe("bgm",!0),oe.updateShareData({title:(null==(e=de.meta)?void 0:e.title)??"",desc:(null==(l=de.meta)?void 0:l.desc)??"",link:location.origin+de.path,imgUrl:(null==(a=de.meta)?void 0:a.imgUrl)??""}),document.addEventListener("visibilitychange",(e=>{document.hidden?d():Ie.volume&&qe("bgm",!0)}))}))})),(e,l)=>(t(),m(p,null,[r("div",{id:"page-0109-key",class:y({m:ye.value})},[r("div",{id:"page-game",class:y(["page-layer",{dialogs:ke.value||fe.value}])},[r("div",{class:y(`bg-game-${we.value}${_e.value}`)},[r("div",z,[(t(),m(p,null,g(6,(e=>r("span",{key:`icon-key-${e}`,class:y([`icon-key-${e}`,{active:xe.value.includes(e)}]),onClick:k((l=>je("find",e)),["stop"])},[1!==e&&xe.value.includes(e)?(t(),m("span",{key:0,class:y([`icon-key-tips-${e}`]),onClick:k((l=>je("close-tips",e)),["stop"])},null,10,E)):f("",!0)],10,D))),64)),(t(),m(p,null,g(10,(e=>(t(),m(p,null,[e===we.value?(t(),m("span",{key:`icon-special-${e}`,class:y([`icon-special-${e}${_e.value}`]),onClick:k((l=>je("special",e)),["stop"])},null,10,O)):f("",!0)],64)))),64))])],2),r("div",W,[r("div",H,[(t(!0),m(p,null,g(Se.value.gameCount+"",(e=>(t(),m("i",{class:y(`num-s-${e}`)},null,2)))),256))]),r("div",A,[(t(!0),m(p,null,g(Se.value.scoreCount+"",(e=>(t(),m("i",{class:y(`num-s-${e}`)},null,2)))),256))])]),r("div",B,[(t(!0),m(p,null,g(Ke.value,(e=>(t(),m("i",{class:y(`num-${e}`)},null,2)))),256))])],2),"game"===ke.value?(t(),m("div",{key:0,id:"key-game",class:y(`skin-${_e.value}`)},[r("div",null,[r("div",{class:y(`bg-key-game${_e.value}`)},[r("div",F,[(t(),m(p,null,g(44,(e=>r("span",{class:y(["icon-k-1",{special:e===he.value},{active:e===he.value&&Ce.value}]),key:`icon-key-${e}`},[r("i",{onClick:l=>je("game-key",e)},null,8,M)],2))),64))]),r("span",{class:"dialogs-close",onClick:l[0]||(l[0]=e=>je("close-game",""))})],2)])],2)):f("",!0),$(r("div",Y,[r("div",{class:"page-layer",style:w(`transform:scale(${-1!==fe.value.indexOf("eye-")?1:ge.value})`)},[h(x,{name:"fade"},{default:C((()=>[-1!==fe.value.indexOf("word-")?(t(),m("div",{key:0,class:"dialogs-word",onClick:l[1]||(l[1]=k((e=>je("word-close",fe.value)),["stop"]))},[["word-3","word-4"].includes(fe.value)?(t(),m("div",{key:0,class:y(`bg-${fe.value}${_e.value}`)},null,2)):(t(),m("div",{key:1,class:y(`bg-${fe.value}`)},null,2))])):f("",!0)])),_:1}),h(x,{name:"fade-fast"},{default:C((()=>["eye-1"===fe.value?(t(),m("div",J,[r("div",{class:y(`bg-${fe.value}`)},null,2)])):f("",!0)])),_:1}),h(x,{name:"fade-fast"},{default:C((()=>["eye-2"===fe.value?(t(),m("div",P,[r("div",{class:y(`bg-${fe.value}`)},null,2)])):f("",!0)])),_:1}),h(x,{name:"fade"},{default:C((()=>["rule"===fe.value?(t(),m("div",{key:0,class:"dialogs-rule",onClick:l[2]||(l[2]=k((e=>je("rule-close","")),["stop"]))},[r("div",Q,[r("div",R,[_e.value?f("",!0):(t(),m("div",V)),r("div",{class:y(`bg-rule-3${_e.value}`)},null,2)])])])):f("",!0)])),_:1}),h(x,{name:"fade"},{default:C((()=>["success"===fe.value?(t(),m("div",{key:0,class:"dialogs-success",onClick:l[3]||(l[3]=k((e=>je("close-success","")),["stop"]))},[r("div",{class:y(`bg-success${_e.value}`)},null,2)])):f("",!0)])),_:1}),h(x,{name:"fade"},{default:C((()=>["fail"===fe.value?(t(),m("div",{key:0,class:"dialogs-fail",onClick:l[4]||(l[4]=k((e=>je("close-fail","")),["stop"]))},[r("div",{class:y(`bg-fail${_e.value}`)},null,2)])):f("",!0)])),_:1}),h(x,{name:"fade"},{default:C((()=>["empty"===fe.value?(t(),m("div",{key:0,class:"dialogs-empty",onClick:l[5]||(l[5]=k((e=>je("close-empty","")),["stop"]))},X)):f("",!0)])),_:1})],4)],512),[[b,fe.value]])],2),$(r("div",Z,[(t(!0),m(p,null,g(Ie.audioList,(e=>(t(),m("audio",{id:"audio-item-"+e.name,key:"audio-item-"+e.name,src:e.src,loop:e.loop??!1},null,8,ee)))),128))],512),[[b,!1]])],64))}}),[["__scopeId","data-v-7359bb6a"]]);export{le as default};
