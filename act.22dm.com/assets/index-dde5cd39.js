import{_ as e,d as a,u as l,r as s,g as u,a as n,w as i,J as t,G as o,S as v,N as c,e as r,f as d,p as m,o as g,c as p,j as f,m as y,q as k,v as h,D as x,l as b,n as T,T as $,t as C,F as M,s as D,x as N,k as S,y as w,z as L,B as U,C as _,M as I,O as E,P as j,Q as B}from"./index-07d41525.js";import{w as K}from"./wxjssdk-9390c5f7.js";import{g as A}from"./sign-54d406fa.js";import{s as V,h as X}from"./loading-8f47663b.js";import{t as Y}from"./throttle-b72c38b4.js";import"./isObjectLike-38825d63.js";const z=e=>(E("data-v-47dc451a"),e=e(),j(),e),G={key:0,id:"mm",class:"scene-layer bg-mm"},O={class:"mm-top"},R={class:"mm-top-left"},W={class:"mm-top-right"},q=z((()=>f("div",{class:"icon-mm-title"},null,-1))),F={key:0,id:"game",class:"scene-layer bg-game"},H={class:"target-score topbar-score"},J={class:"game-score topbar-score"},P={class:"topbar-timer"},Q={key:0,class:"icon-50"},Z={key:0,class:"game-alert icon-alert-timer"},ee={key:1,class:"game-alert icon-alert-miss"},ae={class:"game-hole"},le=z((()=>f("div",{class:"icon-hole-0"},null,-1))),se=z((()=>f("div",{class:"icon-hole-1"},null,-1))),ue=["id"],ne=["onClick"],ie=["onClick"],te={key:0,class:"icon-egg-out"},oe={id:"page-dialogs"},ve={class:"gameover-content"},ce={class:"icon-gameover-score"},re={class:"gameover-score-text"},de={key:0,class:"bg-gameover-success-2 scene-layer"},me={class:"level-need"},ge={key:0,class:"dialogs-pause"},pe={key:0,class:"dialogs-rank bg-rank"},fe=z((()=>f("span",{class:"icon-rank-title"},null,-1))),ye={class:"rank-list"},ke={class:"icon-rank-num"},he={class:"rank-item-name"},xe={class:"rank-item-score"},be=z((()=>f("i",{class:T("num-rf")},null,-1))),Te=z((()=>f("span",{class:"icon-rank-xi"},null,-1))),$e=z((()=>f("span",{class:"icon-rank-hui"},null,-1))),Ce={key:0,class:"dialogs-address bg-address"},Me={class:"icon-address2"},De={class:"address-form"},Ne={key:0,id:"audio-list"},Se=["id","src","loop"],we=e(a({__name:"index",setup(e){var a,E,j;let z,we,Le,Ue="https://cpe-oss-h5.oss-cn-shenzhen.aliyuncs.com/h5/20251002-v2/image";const{proxy:_e}=B();let Ie=new K({});const Ee=l();let je="",Be=s({eggUpTime:250,eggStopTime:800,eggDownTime:250,eggTimeDecrease:20,eggTimeMin:300,smashDelay:80,eggScore:10,comboLimit:5,comboScore:10,cicfLevelTime:30,normalLevelTime:50,targetScoreCicf:200,targetScoreNormal:500,targetScoreNormalNextAdd:50,targetScoreNormalMax:3e3,cicfMaxLevel:1,eggNextTime:1e3,eggNextCount:2,eggNextTimeDecrease:100,eggNextTimeMin:300,eggNextCountMax:8,targetSuccessLevel:10,eggAddDelayMin:100,eggAddDelayMax:600,alertDuration:1500,eggScoreMonster:-50,monsterRatio:.2});const Ke=(null==(a=Ee.params)?void 0:a.userInfo)??{},Ae=s(1),Ve=s(null==(E=Ee.meta)?void 0:E.activityKey.includes("-cicf"));Le=Ve.value?"ofN_u6nBbWm3k8KmgyWetjEKIGaE":(null==Ke?void 0:Ke.unionid)??"";const Xe=s(u(1600)),Ye=s("mm"),ze=s(""),Ge=s(!1),Oe=s([]),Re=s(!1),We=s(!1),qe=s(!1),Fe=s(1),He=s(0),Je=s([]),Pe=s(0),Qe=s([]),Ze=s(0),ea=s(null),aa=s(0),la=s(0),sa=s(!1),ua=s(!!(null==(j=Ee.query)?void 0:j.showBackBtn)),na=s([]),ia=s(!1),ta=s(!1),oa=s({phone:"",name:"",address:""});let va=null,ca=null,ra=0,da=0,ma=0,ga=0,pa=0;const fa=n({volume:!1,audioList:[{name:"bgm",src:`${Ue}/audio/bgm.mp3`,loop:!0},{name:"dead",src:`${Ue}/audio/dead.mp3`,loop:!1},{name:"monster",src:`${Ue}/audio/monster.mp3`,loop:!1},{name:"timer",src:`${Ue}/audio/timer.mp3`,loop:!1},{name:"fail",src:`${Ue}/audio/fail.mp3`,loop:!1},{name:"out",src:`${Ue}/audio/out.mp3`,loop:!1},{name:"success",src:`${Ue}/audio/success.mp3`,loop:!1}]});i(aa,((e,a)=>{Ve.value||(e>Be.value.comboLimit&&(He.value+=Be.value.comboScore),0===e&&a>Be.value.comboLimit&&(ze.value||qe.value||(ta.value=!0,setTimeout((()=>{ta.value=!1}),Be.value.alertDuration))))})),i(He,(e=>{e>=la.value&&(Ve.value&&Fe.value>=Be.value.cicfMaxLevel?Ma():Ta())}));const ya=()=>{try{if(qe.value||ze.value)return;if(na.value.length<pa&&!qe.value){let e=[];for(let a=na.value.length;a<pa;a++){let a=[];for(let l=1;l<=12;l++)[...na.value,...e].some((e=>e.index===l||4===Math.abs(e.index-l)))||a.push(l);if(!(a.length&&e.length+na.value.length<pa))break;{let l=_(1,3),s=a[_(0,a.length-1)],u=Math.random()<Be.value.monsterRatio,n=Be.value.eggScore;u&&!Ve.value&&(l=4,n=Be.value.eggScoreMonster),e.push({key:(new Date).getTime(),id:l,index:s,dead:0,score:n,status:0})}}e.length&&(e.forEach((e=>{na.value.some((a=>a.index===e.index))||na.value.push(e)})),na.value=na.value.filter(((e,a,l)=>l.findIndex((a=>a.index===e.index))===a)),t((()=>{let e=0;na.value.forEach((a=>{if(a&&!a.animationUpData){const l=document.getElementById(`hole-egg-${a.index}`);if(!l)return;const s=[{transform:"translateX(-50%) translateY(100%)"},{transform:"translateX(-50%) translateY(0%)"}],u={duration:ra,iterations:1,easing:"linear",fill:"forwards"};a.animationUpData=[s,u],e+=_(Be.value.eggAddDelayMin,Be.value.eggAddDelayMax),setTimeout((()=>{l.style.willChange="transform",l.style.backfaceVisibility="hidden",l.style.webkitBackfaceVisibility="hidden";const e=l.animate(s,u);a.animationUp=e,a.status=1,e.onfinish=()=>{a.dead||(a.status=2,xa(a))},Ge.value&&e.pause()}),e)}}))})))}}catch(e){}},ka=Y(ya,50),ha=(e,a,l=0)=>{var s,u;try{if(null===a){const e=na.value.find((e=>e.index===l&&!e.dead&&3!==e.status));if(!e)return;a=e}if(a.dead)return;1===a.status&&(null==(u=null==(s=a.animationUp)?void 0:s.cancel)||u.call(s)),a.dead=4===a.id?4:Math.random()>.5?1:2,He.value+=a.score,a.score<0?(aa.value=0,La("monster"),sa.value=!0,setTimeout((()=>{sa.value=!1}),500)):(aa.value++,La("dead")),He.value=He.value<0?0:He.value,xa(a,!0),ba(e)}catch(n){}},xa=(e,a=!1)=>{try{setTimeout((()=>{if(a||!a&&!e.dead){if(!na.value.some((a=>a.index===e.index&&a.key===e.key)))return;if(!e.animationDown){const a=document.getElementById(`hole-egg-${e.index}`);if(!a)return;const l=a.animate([{transform:"translateX(-50%) translateY(100%)"}],{duration:ma,iterations:1,easing:"linear",fill:"forwards"});e.animationDown=l,e.status=3,l.onfinish=()=>{e.dead||4===e.id||(aa.value=0);const a=na.value.indexOf(e);a>-1&&na.value.splice(a,1),setTimeout((()=>{ka()}),100)},Ge.value&&l.pause()}}}),a?0:da)}catch(l){}},ba=e=>{try{let{pageX:a,pageY:l}=e;const{left:s,top:u}=va.getBoundingClientRect();Ve.value&&(a/=Ae.value,l/=Ae.value);let n=100*Xe.value;Ve.value?ea.value={left:a-s,top:l-u-2*n}:ea.value={left:l-u-35*Xe.value,top:750-a-2*n},setTimeout((()=>{ea.value=null}),1*Be.value.smashDelay)}catch(a){}},Ta=(e=!1)=>{na.value=[],e?(Fe.value=1,Je.value=[],Qe.value=[],la.value=Ve.value?Be.value.targetScoreCicf:Be.value.targetScoreNormal,ra=Be.value.eggUpTime,da=Be.value.eggStopTime,ma=Be.value.eggDownTime,ga=Be.value.eggNextTime,pa=Be.value.eggNextCount):(Qe.value.push((Ve.value?Be.value.cicfLevelTime:Be.value.normalLevelTime)-Pe.value),Je.value.push(He.value),Fe.value++,la.value+=Be.value.targetScoreNormalNextAdd,aa.value=0,ra-=Be.value.eggTimeDecrease,da-=Be.value.eggTimeDecrease,ma-=Be.value.eggTimeDecrease,ga-=Be.value.eggNextTimeDecrease,pa+=.4,pa=Math.floor(pa),la.value=la.value>Be.value.targetScoreNormalMax?Be.value.targetScoreNormalMax:la.value,ra=ra<Be.value.eggTimeMin?Be.value.eggTimeMin:ra,da=da<Be.value.eggTimeMin?Be.value.eggTimeMin:da,ma=ma<Be.value.eggTimeMin?Be.value.eggTimeMin:ma,ga=ga<Be.value.eggNextTimeMin?Be.value.eggNextTimeMin:ga,pa=pa>Be.value.eggNextCountMax?Be.value.eggNextCountMax:pa),Pe.value=Ve.value?Be.value.cicfLevelTime:Be.value.normalLevelTime,He.value=0,Ge.value=!1,Ye.value="game",qe.value=!1,Ve.value?setTimeout((()=>{$a()}),1e3):ze.value="level",t((()=>{va=document.getElementById("game")})),window.playEggGame=!0},$a=()=>{ze.value="",Ca(),ya()},Ca=()=>{ca&&clearInterval(ca),ca=null,Pe.value=Ve.value?Be.value.cicfLevelTime:Be.value.normalLevelTime,ca=setInterval((()=>{ze.value||(Pe.value--,11===Pe.value&&(La("timer"),ze.value||qe.value||(ia.value=!0,setTimeout((()=>{ia.value=!1}),Be.value.alertDuration)))),Pe.value<=0&&(ca&&clearInterval(ca),ca=null,Ma())}),1e3)},Ma=()=>{try{ca&&clearInterval(ca),ca=null,qe.value=!0,na.value=[],Qe.value.push((Ve.value?Be.value.cicfLevelTime:Be.value.normalLevelTime)-Pe.value),Je.value.push(He.value),Ze.value=Je.value.reduce(((e,a)=>e+a),0);const e=Qe.value.reduce(((e,a)=>e+a),0);let a=Fe.value,l=Ze.value;const s={};Ve.value?ze.value=l>=Be.value.targetScoreCicf?"gameover-success":"gameover-fail":ze.value=a>=Be.value.targetSuccessLevel?"gameover-success":"gameover-fail";let u=A({k:je,unionid:Le,score:l,level:a});o({ownerUnionid:Le,activityKey:z,gameScore:l,levelNum:a,playTime:e,k:je,s:u,extra:s}).then((()=>{Sa()})),La("gameover-success"===ze.value?"success":"fail")}catch(e){}},Da=e=>{ze.value=e,"pause"===e&&(Ge.value=!0,na.value.forEach((e=>{var a,l,s,u;1===e.status?null==(l=null==(a=e.animationUp)?void 0:a.pause)||l.call(a):3===e.status&&(null==(u=null==(s=e.animationDown)?void 0:s.pause)||u.call(s))})))},Na=e=>{ze.value="",Ge.value=!1,1===e?Ye.value="mm":2===e&&na.value.forEach((e=>{var a,l,s,u;1===e.status?null==(l=null==(a=e.animationUp)?void 0:a.play)||l.call(a):3===e.status&&(null==(u=null==(s=e.animationDown)?void 0:s.play)||u.call(s))}))},Sa=()=>{v({activityKey:z,periodNum:we,unionid:Le,k:je,endTime:"2026-01-22 00:00:00",rankSize:10}).then((({code:e,data:a})=>{0===e&&(a.some((e=>e.ownerUnionid===Le)),Oe.value=a)}))},wa=e=>{_e.$Message.success(e)},La=(e,a=!1)=>{c(fa,e,a)};return r((async()=>{var e,a;V("加载中...",Ve.value?0:90),z=(null==(e=Ee.meta)?void 0:e.activityKey)??"20251002",we=(null==(a=Ee.meta)?void 0:a.periodNum)??1;const{innerWidth:l,innerHeight:s}=window;if(Ve.value&&l>1600){let e=l/1200,a=s/750;Ae.value=e<a?e:a}d({activityKey:z}).then((({code:e,data:a})=>{0===e&&(je=a.k,a.extra&&(Be.value=a.extra),Sa())})).finally((()=>{X()})),Ve.value||Ie.ready((()=>{var e,a,l;La("bgm",!0),Ie.updateShareData({title:(null==(e=Ee.meta)?void 0:e.title)??"",desc:(null==(a=Ee.meta)?void 0:a.desc)??"",link:location.origin+Ee.path,imgUrl:(null==(l=Ee.meta)?void 0:l.imgUrl)??""}),document.addEventListener("visibilitychange",(e=>{document.hidden?m():fa.volume&&La("bgm",!0)}))}))})),(e,a)=>(g(),p(M,null,[f("div",{id:"page-20251002",class:T({m:!Ve.value,isCICF:Ve.value}),style:C(`scale:${Ae.value}`)},[y($,{name:"fade"},{default:k((()=>["mm"==Ye.value?(g(),p("div",G,[f("div",O,[f("div",R,[ua.value?(g(),p("span",{key:0,class:"btn-back",onClick:a[0]||(a[0]=e=>h(x).back())})):b("",!0),f("span",{class:T(["btn-music",[{active:fa.volume}]]),onClick:a[1]||(a[1]=e=>La("bgm",!0))},null,2)]),f("div",W,[f("span",{class:"btn-rule",onClick:a[2]||(a[2]=e=>Da("rule"))})])]),q,f("div",{class:"btn-start",onClick:a[3]||(a[3]=e=>Ta(!0))})])):b("",!0)])),_:1}),y($,{name:"fade"},{default:k((()=>["game"==Ye.value?(g(),p("div",F,[f("div",{id:"game-top-info",class:"bg-topbar",style:C(`scale:${h(u)(1100,Ve.value)}`)},[f("div",H,[(g(!0),p(M,null,D(la.value+"",((e,a)=>(g(),p("span",{key:"topbar-target-score-"+a,class:T(`num-${e}-s`)},null,2)))),128))]),f("div",J,[(g(!0),p(M,null,D(He.value+"",((e,a)=>(g(),p("span",{key:"topbar-game-score-"+a,class:T(`num-${e}-s`)},null,2)))),128))]),f("div",P," 00 : "+N(Pe.value>10?Pe.value:"0"+Pe.value),1),f("span",{class:"topbar-pause",onClick:a[4]||(a[4]=e=>Da("pause"))}),sa.value?(g(),p("span",Q)):b("",!0)],4),ia.value?(g(),p("div",Z)):b("",!0),ta.value?(g(),p("div",ee)):b("",!0),f("div",{id:"game-hole-list",style:C(`scale:${h(u)(1100,Ve.value)}`),onContextmenu:a[5]||(a[5]=S((()=>{}),["prevent"])),onSelectstart:a[6]||(a[6]=S((()=>{}),["prevent"])),onDragstart:a[7]||(a[7]=S((()=>{}),["prevent"])),class:T({"touch-disabled":Ve.value})},[(g(),p(M,null,D(12,(e=>f("div",{class:"game-hole-box",key:"hole-"+e},[f("div",ae,[le,se,f("div",{class:T(["game-hole-role",{hasEgg:na.value.some((a=>a.index===e))}])},[(g(!0),p(M,null,D(na.value,(a=>(g(),p(M,{key:`egg-${a.index}-${a.key}`},[e===a.index?(g(),p("div",{key:0,class:T(["hole-egg",[`icon-egg-${a.id}`,{dead:a.dead},`icon-dead-${a.dead}`]]),id:"hole-egg-"+a.index},[e===a.index?(g(),p("div",{key:0,class:"hole-egg-click",onClick:e=>ha(e,a)},null,8,ne)):b("",!0)],10,ue)):b("",!0)],64)))),128))],2),f("div",{class:"icon-hole-2",onClick:a=>ha(a,null,e)},null,8,ie),na.value.some((a=>a.index===e&&a.dead&&4!==a.id))?(g(),p("div",te)):b("",!0)])]))),64))],38),ea.value?(g(),p("div",{key:2,class:"icon-smash",style:C(`top:${ea.value.top}px;left:${ea.value.left}px;scale:${Xe.value};`)},null,4)):b("",!0)])):b("",!0)])),_:1}),w(f("div",oe,[y($,{name:"fade"},{default:k((()=>["rule"===ze.value?(g(),p("div",{key:0,class:"dialogs-rule",onClick:a[8]||(a[8]=S((e=>Da("")),["stop"]))},[f("div",{class:"bg-rule bg-100",style:C(`transform:scale(${Xe.value})`)},null,4)])):b("",!0)])),_:1}),y($,{name:"fade"},{default:k((()=>[["gameover-success","gameover-fail"].includes(ze.value)?(g(),p("div",{key:0,class:T(["dialogs-gameover",`bg-${ze.value}`])},[f("div",{class:"gameover-box",style:C(`scale:${h(u)("gameover-success"===ze.value?1055:1500,Ve.value)}`)},[f("div",{class:T(`icon-${ze.value}`)},[f("div",ve,[f("div",ce,[f("div",re,[(g(!0),p(M,null,D(Ze.value+"",((e,a)=>(g(),p("span",{key:"gameover-score-"+a,class:T(`num-${e}-s`)},null,2)))),128))])])])],2)],4),"gameover-success"===ze.value?(g(),p("div",de)):b("",!0),f("span",{class:"btn-back",onClick:a[9]||(a[9]=e=>Na(1))})],2)):b("",!0)])),_:1}),y($,{name:"fade"},{default:k((()=>["level"===ze.value?(g(),p("div",{key:0,class:"dialogs-level",onClick:a[10]||(a[10]=e=>Ve.value||1!==Fe.value?$a():Da("tips"))},[f("div",{class:"bg-level bg-100",style:C(`transform:scale(${Xe.value})`)},[f("div",me,[(g(!0),p(M,null,D(la.value+"",((e,a)=>(g(),p("span",{key:"target-score-"+a,class:T(`num-${e}`)},null,2)))),128))])],4)])):b("",!0)])),_:1}),y($,{name:"fade"},{default:k((()=>["tips"===ze.value?(g(),p("div",{key:0,class:"dialogs-tips",onClick:a[11]||(a[11]=e=>$a())},[f("div",{class:"bg-tips bg-100",style:C(`transform:scale(${Xe.value})`)},null,4)])):b("",!0)])),_:1}),y($,{name:"fade"},{default:k((()=>["pause"===ze.value?(g(),p("div",ge,[f("div",{class:"bg-pause bg-100",style:C(`transform:scale(${Xe.value})`)},[f("span",{class:"pause-reset",onClick:a[12]||(a[12]=e=>Na(1))}),f("span",{class:"pause-continue",onClick:a[13]||(a[13]=e=>Na(2))})],4)])):b("",!0)])),_:1}),y($,{name:"fade"},{default:k((()=>["rank"===ze.value?(g(),p("div",pe,[f("div",{class:"bg-rank-list",style:C(`transform:scale(${Xe.value})`)},[fe,f("div",ye,[(g(!0),p(M,null,D(Oe.value,((e,a)=>{var l;return g(),p("span",{class:"rank-item",key:"rank-item-"+a},[f("span",ke,[f("i",{class:T(`num-r${a+1}`)},null,2)]),f("span",he,N((null==(l=e.userInfo)?void 0:l.nickname)??""),1),f("span",xe,[(g(!0),p(M,null,D(e.gameScore+"",((e,l)=>(g(),p("i",{key:"rank-"+a+"-score-"+l,class:T(`num-${e}-ss`)},null,2)))),128)),be])])})),128))]),Te,$e],4),f("span",{class:"btn-back",onClick:a[14]||(a[14]=e=>Da(""))})])):b("",!0)])),_:1}),y($,{name:"fade"},{default:k((()=>["address"===ze.value?(g(),p("div",Ce,[f("div",Me,[f("div",De,[w(f("input",{class:"address-name","onUpdate:modelValue":a[15]||(a[15]=e=>oa.value.name=e),autocomplete:"off",name:"name"},null,512),[[U,oa.value.name]]),w(f("input",{class:"address-phone","onUpdate:modelValue":a[16]||(a[16]=e=>oa.value.phone=e),autocomplete:"off",name:"phone"},null,512),[[U,oa.value.phone]]),w(f("input",{class:"address-address","onUpdate:modelValue":a[17]||(a[17]=e=>oa.value.address=e),autocomplete:"off",name:"address"},null,512),[[U,oa.value.address]])]),f("span",{class:"btn-back",onClick:a[18]||(a[18]=e=>Da(""))}),f("span",{class:"btn-submit",onClick:a[19]||(a[19]=e=>(()=>{let{phone:e,name:a,address:l}=oa.value,s={};if(a&&e&&l&&!Re.value)if(11==e.length){if(We.value)return;We.value=!0,V("提交中..."),I({activityKey:z,periodNum:we,ownerUnionid:Le,address:l,name:a,phone:e,extra:s}).then((()=>{wa("提交成功"),ze.value="",Re.value=!0})).finally((()=>{We.value=!1,X()}))}else wa("请填写11位手机号码");else wa("请输入正确的信息")})())})])])):b("",!0)])),_:1})],512),[[L,ze.value]])],6),fa.audioList.length?w((g(),p("div",Ne,[(g(!0),p(M,null,D(fa.audioList,(e=>(g(),p("audio",{id:"audio-item-"+e.name,key:"audio-item-"+e.name,src:e.src,loop:e.loop??!1},null,8,Se)))),128))],512)),[[L,!1]]):b("",!0)],64))}}),[["__scopeId","data-v-47dc451a"]]);export{we as default};
